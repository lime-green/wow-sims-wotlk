var e=Object.defineProperty,t=(t,a,s)=>(((t,a,s)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s})(t,"symbol"!=typeof a?a+"":a,s),s);import{T as a}from"./index-50a990e3.chunk.js";import{S as s,aU as r,bF as i,g as n,u as l,b5 as o,C as c,b_ as d,T as p,y as m,z as h,fh as u,a$ as g,s as f,L as y,$ as S,av as I,ak as P,cc as b,fi as k,fj as D,A as E,eB as C,eA as R,fk as w,fl as v,d_ as U,fm as T,f0 as O,eW as A,ez as H,fn as F,fb as W,eC as B,a as x,ba as M,fo as L,aI as N,fp as $,I as G,ap as j,aj as q,fq as V,Y as z,fr as J,b9 as K,fs as _,cw as X,ft as Q,cv as Y,cE as Z,a0 as ee,b$ as te,fu as ae,aC as se,x as re,bH as ie,bI as ne,a8 as le,aq as oe,e6 as ce,e7 as de,br as pe}from"./detailed_results-2fca7066.chunk.js";import{a9 as me,aa as he,P as ue,ab as ge,ac as fe,ad as ye,z as Se,ae as Ie,C as Pe,af as be,ag as ke,E as De,ah as Ee,ai as Ce,aj as Re,ak as we,al as ve,S as Ue,am as Te}from"./preset_utils-c298d622.chunk.js";import{T as Oe,D as Ae,B as He,a as Fe,b as We,P as Be,c as xe}from"./sim-15c523b5.chunk.js";import{D as Me,a as Le,B as Ne,b as $e,c as Ge,P as je,d as qe,e as Ve,f as ze,F as Je,g as Ke,h as _e,i as Xe,j as Qe,O as Ye,k as Ze,U as et,l as tt,m as at,n as st,o as rt}from"./sim-ecc4cd35.chunk.js";import{B as it,D as nt,P as lt,a as ot,b as ct,O as dt,c as pt,d as mt,e as ht,f as ut}from"./sim-62ef7c9b.chunk.js";import{F as gt,D as ft,S as yt,a as St,b as It,P as Pt,c as bt,d as kt}from"./sim-f05a9f54.chunk.js";import{F as Dt,D as Et,S as Ct,a as Rt,b as wt,P as vt,c as Ut}from"./sim-e5eec37e.chunk.js";import{R as Tt,D as Ot,C as At,a as Ht,b as Ft,P as Wt,c as Bt}from"./sim-fccb8c63.chunk.js";import{E as xt,D as Mt,S as Lt,a as Nt,b as $t,P as Gt,c as jt,d as qt,e as Vt,f as zt}from"./sim-720648df.chunk.js";import{E as Jt,D as Kt,S as _t,a as Xt,b as Qt,P as Yt,c as Zt,d as ea,e as ta}from"./sim-8c585aed.chunk.js";import{R as aa,D as sa,a as ra,b as ia,c as na,P as la,d as oa}from"./sim-df3fa02e.chunk.js";import{H as ca,D as da,B as pa,a as ma,b as ha,M as ua,c as ga,d as fa,e as ya,f as Sa,g as Ia,S as Pa,h as ba,i as ka,j as Da,k as Ea}from"./sim-4a655621.chunk.js";import{M as Ca,D as Ra,A as wa,a as va,b as Ua,O as Ta,c as Oa,d as Aa,e as Ha,f as Fa,F as Wa,g as Ba,h as xa,i as Ma,j as La,k as Na,l as $a,m as Ga,n as ja,o as qa,p as Va,q as za}from"./sim-ce78e20e.chunk.js";import{R as Ja,D as Ka,A as _a,a as Xa,b as Qa,P as Ya,c as Za,d as es,C as ts,e as as,f as ss,g as rs}from"./sim-a91aaa14.chunk.js";import{H as is,D as ns,S as ls,a as os,b as cs,P as ds,c as ps}from"./sim-98225bb2.chunk.js";import{P as ms,D as hs,G as us,a as gs,b as fs,c as ys,d as Ss}from"./sim-25f81dbe.chunk.js";import{R as Is,D as Ps,A as bs,a as ks,b as Ds,P as Es,c as Cs,d as Rs,e as ws,f as vs}from"./sim-8ebb4620.chunk.js";import{H as Us,D as Ts,a as Os,b as As,c as Hs,d as Fs,e as Ws,f as Bs,g as xs,h as Ms,i as Ls}from"./sim-d96406ea.chunk.js";import{S as Ns,D as $s,a as Gs,b as js,c as qs,P as Vs,d as zs,e as Js}from"./sim-de0a0b6b.chunk.js";import{S as Ks,D as _s,a as Xs,b as Qs,c as Ys,P as Zs}from"./sim-8e3da9f1.chunk.js";import{W as er,A as tr,a as ar,D as sr,b as rr,P as ir,c as nr,d as lr,e as or,f as cr,F as dr,g as pr,h as mr,i as hr,j as ur}from"./sim-01242142.chunk.js";import{P as gr,D as fr,S as yr,a as Sr,b as Ir,c as Pr,d as br}from"./sim-2415f8b2.chunk.js";import{W as kr,A as Dr,a as Er,b as Cr,D as Rr,P as wr,c as vr,d as Ur,e as Tr,O as Or,f as Ar,g as Hr,h as Fr,i as Wr,j as Br,k as xr,l as Mr,m as Lr,n as Nr,o as $r,p as Gr,q as jr}from"./sim-f8087bd9.chunk.js";import"./totem_inputs-5182b4d5.chunk.js";import"./apl_utils-33b83ec1.chunk.js";const qr={[s.SpecTankDeathknight]:(e,t)=>new Oe(e,t),[s.SpecDeathknight]:(e,t)=>new Me(e,t),[s.SpecBalanceDruid]:(e,t)=>new it(e,t),[s.SpecFeralDruid]:(e,t)=>new gt(e,t),[s.SpecFeralTankDruid]:(e,t)=>new Dt(e,t),[s.SpecRestorationDruid]:(e,t)=>new Tt(e,t),[s.SpecElementalShaman]:(e,t)=>new xt(e,t),[s.SpecEnhancementShaman]:(e,t)=>new Jt(e,t),[s.SpecRestorationShaman]:(e,t)=>new aa(e,t),[s.SpecHunter]:(e,t)=>new ca(e,t),[s.SpecMage]:(e,t)=>new Ca(e,t),[s.SpecRogue]:(e,t)=>new Ja(e,t),[s.SpecHolyPaladin]:(e,t)=>new is(e,t),[s.SpecProtectionPaladin]:(e,t)=>new ms(e,t),[s.SpecRetributionPaladin]:(e,t)=>new Is(e,t),[s.SpecHealingPriest]:(e,t)=>new Us(e,t),[s.SpecShadowPriest]:(e,t)=>new Ns(e,t),[s.SpecSmitePriest]:(e,t)=>new Ks(e,t),[s.SpecWarrior]:(e,t)=>new er(e,t),[s.SpecProtectionWarrior]:(e,t)=>new gr(e,t),[s.SpecWarlock]:(e,t)=>new kr(e,t)},Vr=[{spec:s.SpecTankDeathknight,rotation:Ae,talents:He.data,specOptions:Fe,consumes:We,defaultName:"Blood Tank",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceTroll},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Be.gear,2:xe.gear},[r.Horde]:{1:Be.gear,2:xe.gear}},tooltip:"Blood Tank Death Knight",iconUrl:n(l.ClassDeathknight,0)},{spec:s.SpecDeathknight,rotation:Le,talents:Ne.data,specOptions:$e,consumes:Ge,defaultName:"Blood DPS",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:je.gear,2:qe.gear,3:Ve.gear},[r.Horde]:{1:je.gear,2:qe.gear,3:Ve.gear}},tooltip:"Blood DPS Death Knight",iconUrl:n(l.ClassDeathknight,3)},{spec:s.SpecDeathknight,rotation:ze,talents:Je.data,specOptions:Ke,consumes:Ge,defaultName:"Frost",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceTroll},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:_e.gear,2:Xe.gear,3:Qe.gear},[r.Horde]:{1:_e.gear,2:Xe.gear,3:Qe.gear}},otherDefaults:Ye,tooltip:"Frost Death Knight",iconUrl:n(l.ClassDeathknight,1)},{spec:s.SpecDeathknight,rotation:Ze,talents:et.data,specOptions:tt,consumes:Ge,defaultName:"Unholy",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceTroll},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:at.gear,2:st.gear,3:rt.gear},[r.Horde]:{1:at.gear,2:st.gear,3:rt.gear}},otherDefaults:Ye,tooltip:"Dual-Wield Unholy DK",iconUrl:n(l.ClassDeathknight,2)},{spec:s.SpecBalanceDruid,rotation:nt,talents:lt.data,specOptions:ot,consumes:ct,otherDefaults:dt,defaultName:"Balance",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceNightElf,[r.Horde]:i.RaceTauren},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:pt.gear,2:mt.gear,3:ht.gear},[r.Horde]:{1:pt.gear,2:mt.gear,3:ut.gear}},tooltip:o[s.SpecBalanceDruid],iconUrl:n(l.ClassDruid,0)},{spec:s.SpecFeralDruid,rotation:ft,talents:yt.data,specOptions:St,consumes:It,defaultName:"Cat",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceNightElf,[r.Horde]:i.RaceTauren},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Pt.gear,2:bt.gear,3:kt.gear},[r.Horde]:{1:Pt.gear,2:bt.gear,3:kt.gear}},tooltip:o[s.SpecFeralDruid],iconUrl:n(l.ClassDruid,3)},{spec:s.SpecFeralTankDruid,rotation:Et,talents:Ct.data,specOptions:Rt,consumes:wt,defaultName:"Bear",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceNightElf,[r.Horde]:i.RaceTauren},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:vt.gear,2:Ut.gear},[r.Horde]:{1:vt.gear,2:Ut.gear}},tooltip:o[s.SpecFeralTankDruid],iconUrl:n(l.ClassDruid,1)},{spec:s.SpecRestorationDruid,rotation:Ot,talents:At.data,specOptions:Ht,consumes:Ft,defaultName:"Restoration",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceNightElf,[r.Horde]:i.RaceTauren},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Wt.gear,2:Bt.gear},[r.Horde]:{1:Wt.gear,2:Bt.gear}},tooltip:o[s.SpecRestorationDruid],iconUrl:n(l.ClassDruid,2)},{spec:s.SpecHunter,rotation:da,talents:pa.data,specOptions:ma,consumes:ha,defaultName:"Beast Mastery",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceNightElf,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:ua.gear,2:ga.gear,3:fa.gear,4:ya.gear},[r.Horde]:{1:ua.gear,2:ga.gear,3:fa.gear,4:ya.gear}},tooltip:"Beast Mastery Hunter",iconUrl:n(l.ClassHunter,0)},{spec:s.SpecHunter,rotation:da,talents:Sa.data,specOptions:Ia,consumes:ha,defaultName:"Marksmanship",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceNightElf,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:ua.gear,2:ga.gear,3:fa.gear,4:ya.gear},[r.Horde]:{1:ua.gear,2:ga.gear,3:fa.gear,4:ya.gear}},tooltip:"Marksmanship Hunter",iconUrl:n(l.ClassHunter,1)},{spec:s.SpecHunter,rotation:da,talents:Pa.data,specOptions:Ia,consumes:ha,defaultName:"Survival",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceNightElf,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:ba.gear,2:ka.gear,3:Da.gear,4:Ea.gear},[r.Horde]:{1:ba.gear,2:ka.gear,3:Da.gear,4:Ea.gear}},tooltip:"Survival Hunter",iconUrl:n(l.ClassHunter,2)},{spec:s.SpecMage,rotation:Ra,talents:wa.data,specOptions:va,consumes:Ua,otherDefaults:Ta,defaultName:"Arcane",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceGnome,[r.Horde]:i.RaceTroll},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Oa.gear,2:Aa.gear,3:Ha.gear},[r.Horde]:{1:Oa.gear,2:Aa.gear,3:Fa.gear}},tooltip:"Arcane Mage",iconUrl:n(l.ClassMage,0)},{spec:s.SpecMage,rotation:Ra,talents:Wa.data,specOptions:Ba,consumes:xa,otherDefaults:Ta,defaultName:"TTW Fire",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceGnome,[r.Horde]:i.RaceTroll},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Ma.gear,2:La.gear,3:Na.gear},[r.Horde]:{1:Ma.gear,2:La.gear,3:$a.gear}},tooltip:"TTW Fire Mage",iconUrl:n(l.ClassMage,1)},{spec:s.SpecMage,rotation:Ra,talents:Ga.data,specOptions:ja,consumes:xa,otherDefaults:Ta,defaultName:"FFB Fire",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceGnome,[r.Horde]:i.RaceTroll},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Ma.gear,2:qa.gear,3:Va.gear},[r.Horde]:{1:Ma.gear,2:qa.gear,3:za.gear}},tooltip:"FFB Fire Mage",iconUrl:"https://wow.zamimg.com/images/wow/icons/medium/ability_mage_frostfirebolt.jpg"},{spec:s.SpecRogue,rotation:Ka,talents:_a.data,specOptions:Xa,consumes:Qa,defaultName:"Assassination",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Ya.gear,2:Za.gear,3:es.gear},[r.Horde]:{1:Ya.gear,2:Za.gear,3:es.gear}},tooltip:"Assassination Rogue",iconUrl:n(l.ClassRogue,0)},{spec:s.SpecRogue,rotation:Ka,talents:ts.data,specOptions:Xa,consumes:Qa,defaultName:"Combat",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:as.gear,2:ss.gear,3:rs.gear},[r.Horde]:{1:as.gear,2:ss.gear,3:rs.gear}},tooltip:"Combat Rogue",iconUrl:n(l.ClassRogue,1)},{spec:s.SpecElementalShaman,rotation:Mt,talents:Lt.data,specOptions:Nt,consumes:$t,defaultName:"Elemental",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceDraenei,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Gt.gear,2:jt.gear,3:qt.gear,4:Vt.gear},[r.Horde]:{1:Gt.gear,2:jt.gear,3:zt.gear,4:Vt.gear}},tooltip:o[s.SpecElementalShaman],iconUrl:n(l.ClassShaman,0)},{spec:s.SpecEnhancementShaman,rotation:Kt,talents:_t.data,specOptions:Xt,consumes:Qt,defaultName:"Enhancement",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceDraenei,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Yt.gear,2:Zt.gear,3:ea.gear},[r.Horde]:{1:Yt.gear,2:Zt.gear,3:ta.gear}},tooltip:o[s.SpecEnhancementShaman],iconUrl:n(l.ClassShaman,1)},{spec:s.SpecRestorationShaman,rotation:sa,talents:ra.data,specOptions:ia,consumes:na,defaultName:"Restoration",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceDraenei,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:la.gear,2:oa.gear},[r.Horde]:{1:la.gear,2:oa.gear}},tooltip:o[s.SpecRestorationShaman],iconUrl:n(l.ClassShaman,2)},{spec:s.SpecHealingPriest,rotation:Ts,talents:Os.data,specOptions:As,consumes:Hs,defaultName:"Discipline",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceDwarf,[r.Horde]:i.RaceUndead},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Fs.gear,2:Ws.gear},[r.Horde]:{1:Fs.gear,2:Ws.gear}},tooltip:"Discipline Priest",iconUrl:n(l.ClassPriest,0)},{spec:s.SpecHealingPriest,rotation:Bs,talents:xs.data,specOptions:As,consumes:Hs,defaultName:"Holy",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceDwarf,[r.Horde]:i.RaceUndead},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Ms.gear,2:Ls.gear},[r.Horde]:{1:Ms.gear,2:Ls.gear}},tooltip:"Holy Priest",iconUrl:n(l.ClassPriest,1)},{spec:s.SpecShadowPriest,rotation:$s,talents:Gs.data,specOptions:js,consumes:qs,defaultName:"Shadow",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceDwarf,[r.Horde]:i.RaceUndead},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Vs.gear,2:zs.gear,3:Js.gear},[r.Horde]:{1:Vs.gear,2:zs.gear,3:Js.gear}},tooltip:o[s.SpecShadowPriest],iconUrl:n(l.ClassPriest,2)},{spec:s.SpecSmitePriest,rotation:_s,talents:Xs.data,specOptions:Qs,consumes:Ys,defaultName:"Smite",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceDwarf,[r.Horde]:i.RaceUndead},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Zs.gear,2:zs.gear},[r.Horde]:{1:Zs.gear,2:zs.gear}},tooltip:o[s.SpecSmitePriest],iconUrl:n(l.ClassPriest,3)},{spec:s.SpecWarrior,rotation:tr,talents:ar.data,specOptions:sr,consumes:rr,defaultName:"Arms",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:ir.gear,2:nr.gear,3:lr.gear},[r.Horde]:{1:ir.gear,2:nr.gear,3:or.gear}},tooltip:"Arms Warrior",iconUrl:n(l.ClassWarrior,0)},{spec:s.SpecWarrior,rotation:cr,talents:dr.data,specOptions:sr,consumes:rr,defaultName:"Fury",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:pr.gear,2:mr.gear,3:hr.gear},[r.Horde]:{1:pr.gear,2:mr.gear,3:ur.gear}},tooltip:"Fury Warrior",iconUrl:n(l.ClassWarrior,1)},{spec:s.SpecProtectionWarrior,rotation:fr,talents:yr.data,specOptions:Sr,consumes:Ir,defaultName:"Protection",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Pr.gear,2:br.gear},[r.Horde]:{1:Pr.gear,2:br.gear}},tooltip:"Protection Warrior",iconUrl:n(l.ClassWarrior,2)},{spec:s.SpecHolyPaladin,rotation:ns,talents:ls.data,specOptions:os,consumes:cs,defaultName:"Holy",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceBloodElf},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:ds.gear,2:ps.gear},[r.Horde]:{1:ds.gear,2:ps.gear}},tooltip:"Holy Paladin",iconUrl:n(l.ClassPaladin,0)},{spec:s.SpecProtectionPaladin,rotation:hs,talents:us.data,specOptions:gs,consumes:fs,defaultName:"Protection",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceBloodElf},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:ys.gear,2:Ss.gear},[r.Horde]:{1:ys.gear,2:Ss.gear}},tooltip:"Protection Paladin",iconUrl:n(l.ClassPaladin,1)},{spec:s.SpecRetributionPaladin,rotation:Ps,talents:bs.data,specOptions:ks,consumes:Ds,defaultName:"Retribution",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceBloodElf},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Es.gear,2:Cs.gear,3:Rs.gear,4:ws.gear,5:vs.gear},[r.Horde]:{1:Es.gear,2:Cs.gear,3:Rs.gear,4:ws.gear,5:vs.gear}},tooltip:"Retribution Paladin",iconUrl:n(l.ClassPaladin,2)},{spec:s.SpecWarlock,rotation:Dr,talents:Er.data,specOptions:Cr,consumes:Rr,defaultName:"Affliction",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:wr.gear,2:vr.gear,3:Ur.gear},[r.Horde]:{1:wr.gear,2:vr.gear,3:Tr.gear}},otherDefaults:Or,tooltip:"Affliction Warlock",iconUrl:n(l.ClassWarlock,0)},{spec:s.SpecWarlock,rotation:Ar,talents:Hr.data,specOptions:Fr,consumes:Rr,defaultName:"Demonology",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Wr.gear,2:Br.gear,3:xr.gear},[r.Horde]:{1:Wr.gear,2:Br.gear,3:Mr.gear}},otherDefaults:Or,tooltip:"Demonology Warlock",iconUrl:n(l.ClassWarlock,1)},{spec:s.SpecWarlock,rotation:Lr,talents:Nr.data,specOptions:$r,consumes:Rr,defaultName:"Destruction",defaultFactionRaces:{[r.Unknown]:i.RaceUnknown,[r.Alliance]:i.RaceHuman,[r.Horde]:i.RaceOrc},defaultGear:{[r.Unknown]:{},[r.Alliance]:{1:Wr.gear,2:Br.gear,3:Gr.gear},[r.Horde]:{1:Wr.gear,2:Br.gear,3:jr.gear}},otherDefaults:Or,tooltip:"Destruction Warlock",iconUrl:n(l.ClassWarlock,2)}],zr=[...new Set(Vr.map((e=>e.spec)))],Jr=-1;class Kr extends c{constructor(e,a){super(e,"raid-picker-root"),t(this,"raidSimUI"),t(this,"raid"),t(this,"partyPickers"),t(this,"newPlayerPicker"),t(this,"currentDragPlayer",null),t(this,"currentDragPlayerFromIndex",Jr),t(this,"currentDragType",1),t(this,"currentDragParty",null),this.raidSimUI=a,this.raid=a.sim.raid;const s=document.createElement("div");s.classList.add("raid-controls"),this.rootElem.appendChild(s),this.newPlayerPicker=new Yr(this.rootElem,this),new me(s,this.raidSimUI.sim.raid,{label:"Raid Size",labelTooltip:"Number of players participating in the sim.",values:[{name:"5",value:1},{name:"10",value:2},{name:"25",value:5},{name:"40",value:8}],changedEvent:e=>e.numActivePartiesChangeEmitter,getValue:e=>e.getNumActiveParties(),setValue:(e,t,a)=>{t.setNumActiveParties(e,a)}}),new me(s,this.newPlayerPicker,{label:"Default Faction",labelTooltip:"Default faction for newly-created players.",values:[{name:"Alliance",value:r.Alliance},{name:"Horde",value:r.Horde}],changedEvent:e=>this.raid.sim.factionChangeEmitter,getValue:e=>this.raid.sim.getFaction(),setValue:(e,t,a)=>{this.raid.sim.setFaction(e,a)}});const i=Math.min(...Vr.map((e=>Math.max(...Object.keys(e.defaultGear[r.Alliance]).map((e=>parseInt(e)))))));new me(s,this.newPlayerPicker,{label:"Default Gear",labelTooltip:"Newly-created players will start with approximate BIS gear from this phase.",values:[...Array(i).keys()].map((e=>{const t=e+1;return{name:"Phase "+t,value:t}})),changedEvent:e=>this.raid.sim.phaseChangeEmitter,getValue:e=>this.raid.sim.getPhase(),setValue:(e,t,a)=>{this.raid.sim.setPhase(e,a)}});const n=document.createElement("div");n.classList.add("parties-container"),this.rootElem.appendChild(n),this.partyPickers=this.raid.getParties().map(((e,t)=>new _r(n,e,t,this)));const l=()=>{this.partyPickers.forEach((e=>{e.index<this.raidSimUI.sim.raid.getNumActiveParties()?e.rootElem.classList.add("active"):e.rootElem.classList.remove("active")}))};this.raidSimUI.sim.raid.numActivePartiesChangeEmitter.on(l),l(),this.rootElem.ondragend=e=>{this.clearDragPlayer(),this.clearDragParty()}}getCurrentFaction(){return this.raid.sim.getFaction()}getCurrentPhase(){return this.raid.sim.getPhase()}getPlayerPicker(e){return this.partyPickers[Math.floor(e/he)].playerPickers[e%he]}getPlayerPickers(){return[...new Array(25).keys()].map((e=>this.getPlayerPicker(e)))}setDragPlayer(e,t,a){if(this.clearDragPlayer(),this.currentDragPlayer=e,this.currentDragPlayerFromIndex=t,this.currentDragType=a,t!=Jr){this.getPlayerPicker(t).rootElem.classList.add("dragfrom")}}clearDragPlayer(){if(this.currentDragPlayerFromIndex!=Jr){this.getPlayerPicker(this.currentDragPlayerFromIndex).rootElem.classList.remove("dragfrom")}this.currentDragPlayer=null,this.currentDragPlayerFromIndex=Jr,this.currentDragType=1}setDragParty(e){this.currentDragParty=e,e.rootElem.classList.add("dragfrom")}clearDragParty(){this.currentDragParty&&(this.currentDragParty.rootElem.classList.remove("dragfrom"),this.currentDragParty=null)}}class _r extends c{constructor(e,a,s,r){super(e,"party-picker-root"),t(this,"party"),t(this,"index"),t(this,"raidPicker"),t(this,"playerPickers"),this.party=a,this.index=s,this.raidPicker=r,this.rootElem.setAttribute("draggable","true"),this.rootElem.innerHTML=`\n\t\t\t<div class="party-header">\n\t\t\t\t<label class="party-label form-label">Group ${s+1}</label>\n\t\t\t\t<div class="party-results">\n\t\t\t\t\t<span class="party-results-dps"></span>\n\t\t\t\t\t<span class="party-results-reference-delta"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="players-container">\n\t\t\t</div>\n\t\t`;const i=this.rootElem.getElementsByClassName("players-container")[0];this.playerPickers=[...Array(he).keys()].map((e=>new Xr(i,this,e)));const n=this.rootElem.getElementsByClassName("party-results-dps")[0],l=this.rootElem.getElementsByClassName("party-results-reference-delta")[0];this.raidPicker.raidSimUI.referenceChangeEmitter.on((()=>{const e=this.raidPicker.raidSimUI.getCurrentData(),t=this.raidPicker.raidSimUI.getReferenceData(),a=e?.simResult.raidMetrics.parties[this.index]?.dps.avg||0,s=t?.simResult.raidMetrics.parties[this.index]?.dps.avg||0;if(0==a&&0==s)return n.textContent="",void(l.textContent="");n.textContent=`${a.toFixed(1)} DPS`,t?d(l,s,a,1):l.textContent=""})),this.rootElem.ondragstart=e=>{e.target==this.rootElem&&(e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="all",this.raidPicker.setDragParty(this))};let o=0;this.rootElem.ondragenter=e=>{e.preventDefault(),this.raidPicker.currentDragParty&&(o++,this.rootElem.classList.add("dragto"))},this.rootElem.ondragleave=e=>{e.preventDefault(),this.raidPicker.currentDragParty&&(o--,o<=0&&this.rootElem.classList.remove("dragto"))},this.rootElem.ondragover=e=>{e.preventDefault()},this.rootElem.ondrop=e=>{if(!this.raidPicker.currentDragParty)return;e.preventDefault(),o=0,this.rootElem.classList.remove("dragto");const t=p.nextEventID();p.freezeAllAndDo((()=>{const e=this.raidPicker.currentDragParty;for(let a=0;a<he;a++){const s=e.playerPickers[a],r=this.playerPickers[a],i=s.player,n=r.player;s.setPlayer(t,n,3),r.setPlayer(t,i,3)}})),this.raidPicker.clearDragParty()}}}class Xr extends c{constructor(e,a,s){super(e,"player-picker-root"),t(this,"index"),t(this,"raidIndex"),t(this,"player"),t(this,"partyPicker"),t(this,"raidPicker"),t(this,"labelElem"),t(this,"iconElem"),t(this,"nameElem"),t(this,"resultsElem"),t(this,"dpsResultElem"),t(this,"referenceDeltaElem"),this.index=s,this.raidIndex=a.index*he+s,this.player=null,this.partyPicker=a,this.raidPicker=a.raidPicker,this.labelElem=null,this.iconElem=null,this.nameElem=null,this.resultsElem=null,this.dpsResultElem=null,this.referenceDeltaElem=null,this.rootElem.classList.add("player"),this.partyPicker.party.compChangeEmitter.on((e=>{const t=this.partyPicker.party.getPlayer(this.index);t!=this.player&&this.setPlayer(e,t,0)})),this.raidPicker.raidSimUI.referenceChangeEmitter.on((()=>{const e=this.raidPicker.raidSimUI.getCurrentData(),t=this.raidPicker.raidSimUI.getReferenceData(),a=e?.simResult.getPlayerWithRaidIndex(this.raidIndex)?.dps.avg||0,s=t?.simResult.getPlayerWithRaidIndex(this.raidIndex)?.dps.avg||0;this.player&&(this.resultsElem?.classList.remove("hide"),this.dpsResultElem.textContent=`${a.toFixed(1)} DPS`,t&&d(this.referenceDeltaElem,s,a,1))}));let r=0;this.rootElem.ondragenter=e=>{e.preventDefault(),this.raidPicker.currentDragParty||(r++,this.rootElem.classList.add("dragto"))},this.rootElem.ondragleave=e=>{e.preventDefault(),this.raidPicker.currentDragParty||(r--,r<=0&&this.rootElem.classList.remove("dragto"))},this.rootElem.ondragover=e=>e.preventDefault(),this.rootElem.ondrop=e=>{if(this.raidPicker.currentDragParty)return;var t=e.dataTransfer.getData("text/plain");e.preventDefault(),r=0,this.rootElem.classList.remove("dragto");const a=p.nextEventID();p.freezeAllAndDo((()=>{if(null==this.raidPicker.currentDragPlayer&&0==t.length)return;if(this.raidPicker.currentDragPlayerFromIndex==this.raidIndex)return void this.raidPicker.clearDragPlayer();const e=this.raidPicker.currentDragType;if(this.raidPicker.currentDragPlayerFromIndex!=Jr){const t=this.raidPicker.getPlayerPicker(this.raidPicker.currentDragPlayerFromIndex);3==e?t.setPlayer(a,this.player,e):2==e&&t.setPlayer(a,null,e)}else if(null==this.raidPicker.currentDragPlayer){const e=atob(t),r=new Uint8Array(e.length);for(let t=0;t<r.length;t++)r[t]=e.charCodeAt(t);const i=m.fromBinary(r);var s=new ue(h(i),this.raidPicker.raidSimUI.sim);s.fromProto(a,i),this.raidPicker.currentDragPlayer=s}4==e?this.setPlayer(a,this.raidPicker.currentDragPlayer.clone(a),e):this.setPlayer(a,this.raidPicker.currentDragPlayer,e),this.raidPicker.clearDragPlayer()}))},this.update()}setPlayer(e,t,a){t!=this.player&&(p.freezeAllAndDo((()=>{this.player=t,t?(this.partyPicker.party.setPlayer(e,this.index,t),1==a&&function(e,t,a){if(I(t.spec)){const s=a.getTanks(),r=s.findIndex((e=>null==a.getPlayerFromUnitReference(e)));-1==r?s.length<3&&a.setTanks(e,s.concat([t.makeUnitReference()])):(s[r]=t.makeUnitReference(),a.setTanks(e,s))}if(t.spec==s.SpecBalanceDruid){const a=t.getSpecOptions();a.innervateTarget=P(t.getRaidIndex()),t.setSpecOptions(e,a)}else if(t.spec==s.SpecSmitePriest){const a=t.getSpecOptions();a.powerInfusionTarget=P(t.getRaidIndex()),t.setSpecOptions(e,a)}else if(t.spec==s.SpecMage){const a=t.getSpecOptions();a.focusMagicTarget=P(t.getRaidIndex()),t.setSpecOptions(e,a)}}(e,t,this.raidPicker.raid)):(this.partyPicker.party.setPlayer(e,this.index,t),this.partyPicker.party.compChangeEmitter.emit(e))})),this.update())}update(){if(null==this.player)this.rootElem.className="player-picker-root player",this.rootElem.innerHTML="",this.labelElem=null,this.iconElem=null,this.nameElem=null,this.resultsElem=null,this.dpsResultElem=null,this.referenceDeltaElem=null;else{const e=u(this.player.getClass());this.rootElem.className=`player-picker-root player bg-${e}-dampened`,this.rootElem.innerHTML=`\n\t\t\t\t<div class="player-label">\n\t\t\t\t\t<img class="player-icon" src="${this.player.getSpecIcon()}" draggable="true" />\n\t\t\t\t\t<div class="player-details">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tclass="player-name text-${e}"\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tvalue="${this.player.getName()}"\n\t\t\t\t\t\t\tspellcheck="false"\n\t\t\t\t\t\t\tmaxlength="15"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="player-results hide">\n\t\t\t\t\t\t\t<span class="player-results-dps"></span>\n\t\t\t\t\t\t\t<span class="player-results-reference-delta"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="player-options">\n\t\t\t\t\t<a\n\t\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\t\tclass="player-edit"\n\t\t\t\t\t\trole="button"\n\t\t\t\t\t\tdata-bs-toggle="tooltip"\n\t\t\t\t\t\tdata-bs-title="Click to Edit"\n\t\t\t\t\t>\n\t\t\t\t\t\t<i class="fa fa-edit fa-lg"></i>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a\n\t\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\t\tclass="player-copy link-warning"\n\t\t\t\t\t\trole="button"\n\t\t\t\t\t\tdraggable="true"\n\t\t\t\t\t\tdata-bs-toggle="tooltip"\n\t\t\t\t\t\tdata-bs-title="Drag to Copy"\n\t\t\t\t\t>\n\t\t\t\t\t\t<i class="fa fa-copy fa-lg"></i>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a\n\t\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\t\tclass="player-delete link-danger"\n\t\t\t\t\t\trole="button"\n\t\t\t\t\t\tdata-bs-toggle="tooltip"\n\t\t\t\t\t\tdata-bs-title="Click to Delete"\n\t\t\t\t\t>\n\t\t\t\t\t\t<i class="fa fa-times fa-lg"></i>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t`,this.labelElem=this.rootElem.querySelector(".player-label"),this.iconElem=this.rootElem.querySelector(".player-icon"),this.nameElem=this.rootElem.querySelector(".player-name"),this.resultsElem=this.rootElem.querySelector(".player-results"),this.dpsResultElem=this.rootElem.querySelector(".player-results-dps"),this.referenceDeltaElem=this.rootElem.querySelector(".player-results-reference-delta"),this.bindPlayerEvents()}}bindPlayerEvents(){this.nameElem?.addEventListener("input",(e=>{this.player?.setName(p.nextEventID(),this.nameElem?.value||"")})),this.nameElem?.addEventListener("mousedown",(e=>{this.partyPicker.rootElem.setAttribute("draggable","false")})),this.nameElem?.addEventListener("mouseup",(e=>{this.partyPicker.rootElem.setAttribute("draggable","true")}));const e="Unnamed";this.nameElem?.addEventListener("focusout",(t=>{this.nameElem&&!this.nameElem.value&&(this.nameElem.value=e,this.player?.setName(p.nextEventID(),e))}));const t=(e,t)=>{if(null!=this.player){if(e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="all",this.player){var a=this.player.toProto(!0);e.dataTransfer.setData("text/plain",btoa(String.fromCharCode(...m.toBinary(a))))}this.raidPicker.setDragPlayer(this.player,this.raidIndex,t)}else e.preventDefault()},s=this.rootElem.querySelector(".player-edit"),r=this.rootElem.querySelector(".player-copy"),i=this.rootElem.querySelector(".player-delete");a.getOrCreateInstance(s),a.getOrCreateInstance(r);const n=a.getOrCreateInstance(i);this.iconElem.ondragstart=e=>{e.dataTransfer.setDragImage(this.rootElem,20,20),t(e,3)},s.onclick=e=>{new Qr(this.player)},r.ondragstart=e=>{e.dataTransfer.setDragImage(this.rootElem,20,20),t(e,4)},i.onclick=e=>{n.hide(),this.setPlayer(p.nextEventID(),null,0)}}}class Qr extends ge{constructor(e){super(document.body,"player-editor-modal",{closeButton:{fixed:!0},header:!1}),this.rootElem.id="playerEditorModal",this.body.insertAdjacentHTML("beforeend",'\n\t\t\t<div class="player-editor within-raid-sim"></div>\n\t\t');const t=this.rootElem.getElementsByClassName("player-editor")[0];qr[e.spec](t,e)}}class Yr extends c{constructor(e,s){super(e,"new-player-picker-root"),t(this,"raidPicker"),this.raidPicker=s,g(l).forEach((e=>{if(e==l.ClassUnknown)return;const t=Vr.filter((t=>f[t.spec]==e));if(0==t.length)return;const s=document.createElement("div");s.classList.add("class-presets-container",`bg-${u(e)}-dampened`),this.rootElem.appendChild(s),t.forEach((e=>{const t=document.createElement("fragment");t.innerHTML=`\n\t\t\t\t\t<a\n\t\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\t\trole="button"\n\t\t\t\t\t\tdraggable="true"\n\t\t\t\t\t\tdata-bs-toggle="tooltip"\n\t\t\t\t\t\tdata-bs-title="${e.tooltip}"\n\t\t\t\t\t\tdata-bs-html="true"\n\t\t\t\t\t>\n\t\t\t\t\t\t<img class="preset-picker-icon player-icon" src="${e.iconUrl}"/>\n\t\t\t\t\t</a>\n\t\t\t\t`;const r=t.children[0];s.appendChild(r),a.getOrCreateInstance(r),r.ondragstart=t=>{const a=p.nextEventID();p.freezeAllAndDo((()=>{const s=new Image;s.src=e.iconUrl,t.dataTransfer.setDragImage(s,30,30),t.dataTransfer.setData("text/plain",""),t.dataTransfer.dropEffect="copy";const r=new ue(e.spec,this.raidPicker.raid.sim);r.applySharedDefaults(a),r.setRace(a,e.defaultFactionRaces[this.raidPicker.getCurrentFaction()]),r.setRotation(a,e.rotation),r.setTalentsString(a,e.talents.talentsString),r.setGlyphs(a,e.talents.glyphs||y.create()),r.setSpecOptions(a,e.specOptions),r.setConsumes(a,e.consumes),r.setName(a,e.defaultName),r.setProfession1(a,e.otherDefaults?.profession1||S.Engineering),r.setProfession2(a,e.otherDefaults?.profession2||S.Jewelcrafting),r.setDistanceFromTarget(a,e.otherDefaults?.distanceFromTarget||0),this.raidPicker.raid.sim.waitForInit().then((()=>{r.setGear(a,this.raidPicker.raid.sim.db.lookupEquipmentSpec(e.defaultGear[this.raidPicker.getCurrentFaction()][this.raidPicker.getCurrentPhase()]))})),this.raidPicker.setDragPlayer(r,Jr,1)}))}}))}))}}class Zr extends c{constructor(e,a){super(e,"raid-stats"),t(this,"categories");let s=[];di.sections.forEach((e=>{const t=document.createElement("div");t.classList.add("raid-stats-section"),this.rootElem.appendChild(t),t.innerHTML=`\n\t\t\t\t<div class="raid-stats-section-header">\n\t\t\t\t\t<label class="raid-stats-section-label form-label">${e.label}</label>\n\t\t\t\t</div>\n\t\t\t\t<div class="raid-stats-section-content"></div>\n\t\t\t`;const r=t.getElementsByClassName("raid-stats-section-content")[0];e.categories.forEach((e=>{s.push(new ei(r,a,e))}))})),this.categories=s,a.changeEmitter.on((e=>this.categories.forEach((e=>e.update()))))}}class ei extends c{constructor(e,s,r){if(super(e,"raid-stats-category-root"),t(this,"raidSimUI"),t(this,"options"),t(this,"effects"),t(this,"counterElem"),t(this,"tooltipElem"),this.raidSimUI=s,this.options=r,this.rootElem.innerHTML=`\n\t\t\t<a href="javascript:void(0)" role="button" class="raid-stats-category">\n\t\t\t\t<span class="raid-stats-category-counter"></span>\n\t\t\t\t<span class="raid-stats-category-label">${r.label}</span>\n\t\t\t</a>\n\t\t`,this.counterElem=this.rootElem.querySelector(".raid-stats-category-counter"),this.tooltipElem=document.createElement("div"),this.tooltipElem.innerHTML=`\n\t\t\t<label class="raid-stats-category-label">${r.label}</label>\n\t\t`,this.effects=r.effects.map((e=>new ti(this.tooltipElem,s,e))),1!=r.effects.length||r.effects[0].playerData?.class){const e=this.rootElem.querySelector(".raid-stats-category");a.getOrCreateInstance(e,{customClass:"raid-stats-category-tooltip",html:!0,placement:"right",title:this.tooltipElem})}}update(){this.effects.forEach((e=>e.update()));const e=x(this.effects.map((e=>e.count)));this.counterElem.textContent=String(e);const t=this.rootElem.querySelector(".raid-stats-category");0==e?t?.classList.remove("active"):t?.classList.add("active")}}class ti extends c{constructor(e,a,s){if(super(e,"raid-stats-effect"),t(this,"raidSimUI"),t(this,"options"),t(this,"counterElem"),t(this,"curPlayers"),t(this,"count"),this.raidSimUI=a,this.options=s,this.curPlayers=[],this.count=0,this.rootElem.innerHTML=`\n\t\t\t<span class="raid-stats-effect-counter"></span>\n\t\t\t<img class="raid-stats-effect-icon"></img>\n\t\t\t<span class="raid-stats-effect-label">${s.label}</span>\n\t\t`,this.counterElem=this.rootElem.querySelector(".raid-stats-effect-counter"),this.options.playerData?.class){const e=this.rootElem.querySelector(".raid-stats-effect-label"),t=M(this.options.playerData.class);e.classList.add(t)}const r=this.rootElem.querySelector(".raid-stats-effect-icon");s.actionId?s.actionId.fill().then((e=>r.src=e.iconUrl)):r.remove()}update(){this.options.playerData&&(this.curPlayers=this.raidSimUI.getActivePlayers().filter((e=>this.options.playerData.condition(e))));const e=this.options.raidData&&this.options.raidData(this.raidSimUI.sim.raid);this.count=this.curPlayers.length+(e?1:0),this.counterElem.textContent=String(this.count),0==this.count?this.rootElem.classList.remove("active"):this.rootElem.classList.add("active")}}function ai(e,t){return t?!e:e}function si(e,t){return{class:e,condition:a=>a.isClass(e)&&(!t||t(a))}}function ri(e,t,a,s){return{class:e,condition:r=>r.isClass(e)&&ai(Boolean(r.getTalents()[t]),a)&&(!s||s(r))}}function ii(e,t,a){return ri(e,t,!1,a)}function ni(e,t,a){return ri(e,t,!0,a)}function li(e,t,a,s){return{class:f[e],condition:r=>r.isSpec(e)&&ai(Boolean(r.getTalents()[t]),a)&&(!s||s(r))}}function oi(e,t,a){return li(e,t,!1,a)}function ci(e){return t=>Boolean(t.getBuffs()[e])}const di={sections:[{label:"Roles",categories:[{label:"Tanks",effects:[{label:"Tanks",playerData:{condition:e=>I(e.spec)}}]},{label:"Healers",effects:[{label:"Healers",playerData:{condition:e=>b(e.spec)}}]},{label:"Melee",effects:[{label:"Melee",playerData:{condition:e=>k(e.spec)}}]},{label:"Ranged",effects:[{label:"Ranged",playerData:{condition:e=>D(e.spec)}}]}]},{label:"Buffs",categories:[{label:"Bloodlust",effects:[{label:"Bloodlust",actionId:E.fromSpellId(2825),playerData:si(l.ClassShaman,(e=>e.getSpecOptions().bloodlust))}]},{label:"Stats",effects:[{label:"Improved Gift of the Wild",actionId:E.fromSpellId(17051),playerData:ii(l.ClassDruid,"improvedMarkOfTheWild")},{label:"Gift of the Wild",actionId:E.fromSpellId(48470),playerData:ni(l.ClassDruid,"improvedMarkOfTheWild")},{label:"Drums of the Wild",actionId:E.fromItemId(49634),raidData:ci("drumsOfTheWild")}]},{label:"Stats %",effects:[{label:"Blessing of Kings",actionId:E.fromSpellId(25898),playerData:si(l.ClassPaladin)},{label:"Drums of Forgotten Kings",actionId:E.fromItemId(49633),raidData:ci("drumsOfForgottenKings")},{label:"Blessing of Sanctuary",actionId:E.fromSpellId(25899),playerData:si(l.ClassPaladin)}]},{label:"Armor",effects:[{label:"Improved Devotion Aura",actionId:E.fromSpellId(20140),playerData:ii(l.ClassPaladin,"improvedDevotionAura",(e=>e.getSpecOptions().aura==A.DevotionAura))},{label:"Devotion Aura",actionId:E.fromSpellId(48942),playerData:ni(l.ClassPaladin,"improvedDevotionAura",(e=>e.getSpecOptions().aura==A.DevotionAura))},{label:"Improved Stoneskin Totem",actionId:E.fromSpellId(16293),playerData:ii(l.ClassShaman,"guardianTotems",(e=>e.getSpecOptions().totems?.earth==H.StoneskinTotem))},{label:"Stoneskin Totem",actionId:E.fromSpellId(58753),playerData:ni(l.ClassShaman,"guardianTotems",(e=>e.getSpecOptions().totems?.earth==H.StoneskinTotem))},{label:"Scroll of Protection",actionId:E.fromItemId(43468),raidData:ci("scrollOfProtection")}]},{label:"Stamina",effects:[{label:"Improved Power Word Fortitude",actionId:E.fromSpellId(14767),playerData:ii(l.ClassPriest,"improvedPowerWordFortitude")},{label:"Power Word Fortitude",actionId:E.fromSpellId(48161),playerData:ni(l.ClassPriest,"improvedPowerWordFortitude")},{label:"Scroll of Stamina",actionId:E.fromItemId(37094),raidData:ci("scrollOfStamina")}]},{label:"Str + Agi",effects:[{label:"Improved Strength of Earth Totem",actionId:E.fromSpellId(52456),playerData:ii(l.ClassShaman,"enhancingTotems",(e=>e.getSpecOptions().totems?.earth==H.StrengthOfEarthTotem))},{label:"Strength of Earth Totem",actionId:E.fromSpellId(58643),playerData:ni(l.ClassShaman,"enhancingTotems",(e=>e.getSpecOptions().totems?.earth==H.StrengthOfEarthTotem))},{label:"Horn of Winter",actionId:E.fromSpellId(57623),playerData:si(l.ClassDeathknight)},{label:"Scroll of Strength",actionId:E.fromItemId(43466),raidData:ci("scrollOfStrength")},{label:"Scroll of Agility",actionId:E.fromItemId(43464),raidData:ci("scrollOfAgility")}]},{label:"Intellect",effects:[{label:"Arcane Brilliance",actionId:E.fromSpellId(43002),playerData:si(l.ClassMage)},{label:"Improved Fel Intelligence",actionId:E.fromSpellId(54038),playerData:ii(l.ClassWarlock,"improvedFelhunter",(e=>e.getSpecOptions().summon==F.Felhunter))},{label:"Fel Intelligence",actionId:E.fromSpellId(57567),playerData:ni(l.ClassWarlock,"improvedFelhunter",(e=>e.getSpecOptions().summon==F.Felhunter))},{label:"Scroll of Intellect",actionId:E.fromItemId(37092),raidData:ci("scrollOfIntellect")}]},{label:"Spirit",effects:[{label:"Divine Spirit",actionId:E.fromSpellId(48073),playerData:si(l.ClassPriest)},{label:"Improved Fel Intelligence",actionId:E.fromSpellId(54038),playerData:ii(l.ClassWarlock,"improvedFelhunter",(e=>e.getSpecOptions().summon==F.Felhunter))},{label:"Fel Intelligence",actionId:E.fromSpellId(57567),playerData:ni(l.ClassWarlock,"improvedFelhunter",(e=>e.getSpecOptions().summon==F.Felhunter))},{label:"Scroll of Spirit",actionId:E.fromItemId(37098),raidData:ci("scrollOfSpirit")}]},{label:"Atk Pwr",effects:[{label:"Improved Blessing of Might",actionId:E.fromSpellId(20045),playerData:si(l.ClassPaladin)},{label:"Blessing of Might",actionId:E.fromSpellId(48934),playerData:si(l.ClassPaladin)},{label:"Improved Battle Shout",actionId:E.fromSpellId(12861),playerData:ii(l.ClassWarrior,"commandingPresence",(e=>e.getSpecOptions().shout==W.WarriorShoutBattle))},{label:"Battle Shout",actionId:E.fromSpellId(47436),playerData:ni(l.ClassWarrior,"commandingPresence",(e=>e.getSpecOptions().shout==W.WarriorShoutBattle))}]},{label:"Atk Pwr %",effects:[{label:"Abomination's Might",actionId:E.fromSpellId(53138),playerData:ii(l.ClassDeathknight,"abominationsMight")},{label:"Unleashed Rage",actionId:E.fromSpellId(30809),playerData:ii(l.ClassShaman,"unleashedRage")},{label:"Trueshot Aura",actionId:E.fromSpellId(19506),playerData:ii(l.ClassHunter,"trueshotAura")}]},{label:"Damage %",effects:[{label:"Sanctified Retribution",actionId:E.fromSpellId(31869),playerData:ii(l.ClassPaladin,"sanctifiedRetribution")},{label:"Arcane Empowerment",actionId:E.fromSpellId(31583),playerData:ii(l.ClassMage,"arcaneEmpowerment")},{label:"Ferocious Inspiration",actionId:E.fromSpellId(34460),playerData:ii(l.ClassHunter,"ferociousInspiration")}]},{label:"Mit %",effects:[{label:"Renewed Hope",actionId:E.fromSpellId(57472),playerData:ii(l.ClassPriest,"renewedHope")},{label:"Blessing Of Sanctuary",actionId:E.fromSpellId(25899),playerData:si(l.ClassPaladin)},{label:"Vigilance",actionId:E.fromSpellId(50720),playerData:ii(l.ClassWarrior,"vigilance")}]},{label:"Haste %",effects:[{label:"Swift Retribution",actionId:E.fromSpellId(53648),playerData:ii(l.ClassPaladin,"swiftRetribution")},{label:"Improved Moonkin Form",actionId:E.fromSpellId(48396),playerData:ii(l.ClassDruid,"improvedMoonkinForm")}]},{label:"MP5",effects:[{label:"Improved Blessing of Wisdom",actionId:E.fromSpellId(20245),playerData:ii(l.ClassPaladin,"improvedBlessingOfWisdom")},{label:"Blessing of Wisdom",actionId:E.fromSpellId(48938),playerData:ni(l.ClassPaladin,"improvedBlessingOfWisdom")},{label:"Improved Mana Spring Totem",actionId:E.fromSpellId(16206),playerData:ii(l.ClassShaman,"restorativeTotems",(e=>e.getSpecOptions().totems?.water==B.ManaSpringTotem))},{label:"Mana Spring Totem",actionId:E.fromSpellId(58774),playerData:ni(l.ClassShaman,"restorativeTotems",(e=>e.getSpecOptions().totems?.water==B.ManaSpringTotem))}]},{label:"Melee Crit",effects:[{label:"Leader of the Pack",actionId:E.fromSpellId(17007),playerData:ii(l.ClassDruid,"leaderOfThePack")},{label:"Rampage",actionId:E.fromSpellId(29801),playerData:ii(l.ClassWarrior,"rampage")}]},{label:"Melee Haste",effects:[{label:"Improved Icy Talons",actionId:E.fromSpellId(55610),playerData:ii(l.ClassDeathknight,"improvedIcyTalons")},{label:"Improved Windfury Totem",actionId:E.fromSpellId(29193),playerData:ii(l.ClassShaman,"improvedWindfuryTotem",(e=>e.getSpecOptions().totems?.air==R.WindfuryTotem))},{label:"Windfury Totem",actionId:E.fromSpellId(65990),playerData:ni(l.ClassShaman,"improvedWindfuryTotem",(e=>e.getSpecOptions().totems?.air==R.WindfuryTotem))}]},{label:"Spell Power",effects:[{label:"Demonic Pact",actionId:E.fromSpellId(47240),playerData:ii(l.ClassWarlock,"demonicPact")},{label:"Totem of Wrath",actionId:E.fromSpellId(57722),playerData:ii(l.ClassShaman,"totemOfWrath",(e=>e.getSpecOptions().totems?.fire==C.TotemOfWrath))},{label:"Flametongue Totem",actionId:E.fromSpellId(58656),playerData:si(l.ClassShaman,(e=>e.getSpecOptions().totems?.fire==C.FlametongueTotem))}]},{label:"Spell Crit",effects:[{label:"Moonkin Form",actionId:E.fromSpellId(24907),playerData:oi(s.SpecBalanceDruid,"moonkinForm")},{label:"Elemental Oath",actionId:E.fromSpellId(51470),playerData:ii(l.ClassShaman,"elementalOath")}]},{label:"Spell Haste",effects:[{label:"Wrath of Air Totem",actionId:E.fromSpellId(3738),playerData:si(l.ClassShaman,(e=>e.getSpecOptions().totems?.air==R.WrathOfAirTotem))}]},{label:"Health",effects:[{label:"Improved Commanding Shout",actionId:E.fromSpellId(12861),playerData:ii(l.ClassWarrior,"commandingPresence",(e=>e.getSpecOptions().shout==W.WarriorShoutCommanding))},{label:"Commanding Shout",actionId:E.fromSpellId(47440),playerData:ni(l.ClassWarrior,"commandingPresence",(e=>e.getSpecOptions().shout==W.WarriorShoutCommanding))},{label:"Improved Imp",actionId:E.fromSpellId(18696),playerData:ii(l.ClassWarlock,"improvedImp",(e=>e.getSpecOptions().summon==F.Imp))},{label:"Blood Pact",actionId:E.fromSpellId(47982),playerData:ni(l.ClassWarlock,"improvedImp",(e=>e.getSpecOptions().summon==F.Imp))}]},{label:"Replenishment",effects:[{label:"Vampiric Touch",actionId:E.fromSpellId(48160),playerData:oi(s.SpecShadowPriest,"vampiricTouch")},{label:"Judgements of the Wise",actionId:E.fromSpellId(31878),playerData:oi(s.SpecRetributionPaladin,"judgementsOfTheWise")},{label:"Hunting Party",actionId:E.fromSpellId(53292),playerData:oi(s.SpecHunter,"huntingParty")},{label:"Improved Soul Leech",actionId:E.fromSpellId(54118),playerData:oi(s.SpecWarlock,"improvedSoulLeech")},{label:"Enduring Winter",actionId:E.fromSpellId(44561),playerData:oi(s.SpecMage,"enduringWinter")}]}]},{label:"External Buffs",categories:[{label:"Innervate",effects:[{label:"Innervate",actionId:E.fromSpellId(29166),playerData:si(l.ClassDruid)}]},{label:"Power Infusion",effects:[{label:"Power Infusion",actionId:E.fromSpellId(10060),playerData:ii(l.ClassPriest,"powerInfusion")}]},{label:"Focus Magic",effects:[{label:"Focus Magic",actionId:E.fromSpellId(54648),playerData:ii(l.ClassMage,"focusMagic")}]},{label:"Tricks of the Trade",effects:[{label:"Tricks of the Trade",actionId:E.fromSpellId(57933),playerData:si(l.ClassRogue)}]},{label:"Unholy Frenzy",effects:[{label:"Unholy Frenzy",actionId:E.fromSpellId(49016),playerData:ii(l.ClassDeathknight,"hysteria")}]},{label:"Pain Suppression",effects:[{label:"Pain Suppression",actionId:E.fromSpellId(33206),playerData:ii(l.ClassPriest,"painSuppression")}]},{label:"Divine Guardian",effects:[{label:"Divine Guardian",actionId:E.fromSpellId(53530),playerData:ii(l.ClassPaladin,"divineGuardian")}]}]},{label:"DPS Debuffs",categories:[{label:"Major ArP",effects:[{label:"Sunder Armor",actionId:E.fromSpellId(47467),playerData:si(l.ClassWarrior,(e=>e.isSpec(s.SpecProtectionWarrior)||e.getRotation().sunderArmor==w.SunderArmorMaintain))},{label:"Expose Armor",actionId:E.fromSpellId(8647),playerData:si(l.ClassRogue,(e=>e.getRotation().exposeArmorFrequency==v.Maintain))},{label:"Acid Spit",actionId:E.fromSpellId(55754),playerData:si(l.ClassHunter,(e=>e.getSpecOptions().petType==U.Worm))}]},{label:"Minor ArP",effects:[{label:"Faerie Fire",actionId:E.fromSpellId(770),playerData:si(l.ClassDruid,(e=>e.spec==s.SpecFeralTankDruid||e.spec!=s.SpecRestorationDruid&&e.getRotation().maintainFaerieFire))},{label:"Curse of Weakness",actionId:E.fromSpellId(50511),playerData:si(l.ClassWarlock,(e=>e.getRotation().curse==T.Weakness))},{label:"Sting",actionId:E.fromSpellId(56631),playerData:si(l.ClassHunter,(e=>e.getSpecOptions().petType==U.Wasp))},{label:"Spore Cloud",actionId:E.fromSpellId(53598),playerData:si(l.ClassHunter,(e=>e.getSpecOptions().petType==U.Bat))}]},{label:"Phys Vuln",effects:[{label:"Blood Frenzy",actionId:E.fromSpellId(29859),playerData:ii(l.ClassWarrior,"bloodFrenzy")},{label:"Savage Combat",actionId:E.fromSpellId(58413),playerData:ii(l.ClassRogue,"savageCombat")}]},{label:"Bleed",effects:[{label:"Mangle",actionId:E.fromSpellId(16862),playerData:si(l.ClassDruid,(e=>[s.SpecFeralDruid,s.SpecFeralTankDruid].includes(e.spec)))},{label:"Trauma",actionId:E.fromSpellId(46855),playerData:ii(l.ClassWarrior,"trauma")},{label:"Stampede",actionId:E.fromSpellId(57393),playerData:si(l.ClassHunter,(e=>e.getSpecOptions().petType==U.Rhino))}]},{label:"Crit",effects:[{label:"Totem of Wrath",actionId:E.fromSpellId(30706),playerData:ii(l.ClassShaman,"totemOfWrath",(e=>e.getSpecOptions().totems?.fire==C.TotemOfWrath))},{label:"Heart of the Crusader",actionId:E.fromSpellId(20337),playerData:ii(l.ClassPaladin,"heartOfTheCrusader",(e=>[s.SpecRetributionPaladin,s.SpecProtectionPaladin].includes(e.spec)))},{label:"Master Poisoner",actionId:E.fromSpellId(58410),playerData:ii(l.ClassRogue,"masterPoisoner")}]},{label:"Spell Crit",effects:[{label:"Improved Shadow Bolt",actionId:E.fromSpellId(17803),playerData:ii(l.ClassWarlock,"improvedShadowBolt")},{label:"Improved Scorch",actionId:E.fromSpellId(12873),playerData:ii(l.ClassMage,"improvedScorch",(e=>1==e.getTalentTree()&&e.getRotation().maintainImprovedScorch))},{label:"Winter's Chill",actionId:E.fromSpellId(28593),playerData:ii(l.ClassMage,"wintersChill",(e=>2==e.getTalentTree()))}]},{label:"Spell Hit",effects:[{label:"Misery",actionId:E.fromSpellId(33198),playerData:oi(s.SpecShadowPriest,"misery")},{label:"Improved Faerie Fire",actionId:E.fromSpellId(33602),playerData:oi(s.SpecBalanceDruid,"improvedFaerieFire")}]},{label:"Spell Dmg",effects:[{label:"Ebon Plaguebringer",actionId:E.fromSpellId(51161),playerData:ii(l.ClassDeathknight,"ebonPlaguebringer")},{label:"Earth and Moon",actionId:E.fromSpellId(48511),playerData:oi(s.SpecBalanceDruid,"earthAndMoon")},{label:"Curse of Elements",actionId:E.fromSpellId(47865),playerData:si(l.ClassWarlock,(e=>e.getRotation().curse==T.Elements))}]}]},{label:"Mitigation Debuffs",categories:[{label:"Atk Pwr",effects:[{label:"Vindication",actionId:E.fromSpellId(26016),playerData:ii(l.ClassPaladin,"vindication",(e=>[s.SpecRetributionPaladin,s.SpecProtectionPaladin].includes(e.spec)))},{label:"Improved Demoralizing Shout",actionId:E.fromSpellId(12879),playerData:ii(l.ClassWarrior,"improvedDemoralizingShout",(e=>e.spec==s.SpecWarrior&&e.getRotation().maintainDemoShout||e.spec==s.SpecProtectionWarrior&&0!=e.getRotation().demoShoutChoice))},{label:"Demoralizing Shout",actionId:E.fromSpellId(47437),playerData:ni(l.ClassWarrior,"improvedDemoralizingShout",(e=>e.spec==s.SpecWarrior&&e.getRotation().maintainDemoShout||e.spec==s.SpecProtectionWarrior&&0!=e.getRotation().demoShoutChoice))},{label:"Improved Demoralizing Roar",actionId:E.fromSpellId(16862),playerData:oi(s.SpecFeralTankDruid,"feralAggression",(e=>e.getRotation().maintainDemoralizingRoar))},{label:"Demoralizing Roar",actionId:E.fromSpellId(48560),playerData:(pi=s.SpecFeralTankDruid,mi="feralAggression",hi=e=>e.getRotation().maintainDemoralizingRoar,li(pi,mi,!0,hi))},{label:"Improved Curse of Weakness",actionId:E.fromSpellId(18180),playerData:ii(l.ClassWarlock,"improvedCurseOfWeakness",(e=>e.getRotation().curse==T.Weakness))},{label:"Curse of Weakness",actionId:E.fromSpellId(50511),playerData:ii(l.ClassWarlock,"improvedCurseOfWeakness",(e=>e.getRotation().curse==T.Weakness))},{label:"Demoralizing Screech",actionId:E.fromSpellId(55487),playerData:si(l.ClassHunter,(e=>e.getSpecOptions().petType==U.CarrionBird))}]},{label:"Atk Speed",effects:[{label:"Improved Thunder Clap",actionId:E.fromSpellId(12666),playerData:ii(l.ClassWarrior,"improvedThunderClap",(e=>e.spec==s.SpecWarrior&&e.getRotation().maintainThunderClap||e.spec==s.SpecProtectionWarrior&&0!=e.getRotation().thunderClapChoice))},{label:"Thunder Clap",actionId:E.fromSpellId(47502),playerData:ni(l.ClassWarrior,"improvedThunderClap",(e=>e.spec==s.SpecWarrior&&e.getRotation().maintainThunderClap||e.spec==s.SpecProtectionWarrior&&0!=e.getRotation().thunderClapChoice))},{label:"Improved Frost Fever",actionId:E.fromSpellId(51456),playerData:ii(l.ClassDeathknight,"improvedIcyTouch")},{label:"Frost Fever",actionId:E.fromSpellId(51456),playerData:ni(l.ClassDeathknight,"improvedIcyTouch")},{label:"Judgements of the Just",actionId:E.fromSpellId(53696),playerData:ii(l.ClassPaladin,"judgementsOfTheJust")},{label:"Infected Wounds",actionId:E.fromSpellId(48485),playerData:ii(l.ClassDruid,"infectedWounds",(e=>[s.SpecFeralDruid,s.SpecFeralTankDruid].includes(e.spec)))}]},{label:"Miss",effects:[{label:"Insect Swarm",actionId:E.fromSpellId(65855),playerData:oi(s.SpecBalanceDruid,"insectSwarm")},{label:"Scorpid Sting",actionId:E.fromSpellId(3043),playerData:si(l.ClassHunter,(e=>e.getRotation().sting==O.ScorpidSting))}]}]}]};var pi,mi,hi;class ui extends fe{constructor(e,a){super(e,a,{identifier:"raid-tab",title:"Raid"}),t(this,"simUI"),t(this,"leftPanel"),t(this,"rightPanel"),this.simUI=a,this.rootElem.classList.add("active","show"),this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("raid-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("raid-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.simUI.raidPicker=new Kr(this.leftPanel,this.simUI),new Zr(this.leftPanel,this.simUI);const e=new ye(this.rightPanel,this.simUI,{label:"Raid",header:{title:"Saved Raid Groups"},storageKey:this.simUI.getSavedRaidStorageKey(),getData:e=>L.create({raid:this.simUI.sim.raid.toProto(),blessings:this.simUI.blessingsPicker.getAssignments(),faction:this.simUI.sim.getFaction(),phase:this.simUI.sim.getPhase()}),setData:(e,t,a)=>{p.freezeAllAndDo((()=>{this.simUI.sim.raid.fromProto(e,a.raid||N.create()),this.simUI.blessingsPicker.setAssignments(e,a.blessings||$.create()),a.faction&&this.simUI.sim.setFaction(e,a.faction),a.phase&&this.simUI.sim.setPhase(e,a.phase)}))},changeEmitters:[this.simUI.changeEmitter,this.simUI.sim.changeEmitter],equals:(e,t)=>L.equals(e,t),toJson:e=>L.toJson(e),fromJson:e=>L.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData()}))}}class gi extends G{constructor(e,a,s,r){super(e,"raid-target-picker-root",s,r),t(this,"config"),t(this,"raid"),t(this,"curPlayer"),t(this,"curUnitReference"),t(this,"currentOptions"),t(this,"buttonElem"),t(this,"dropdownElem"),this.rootElem.classList.add("dropdown"),this.config=r,this.raid=a,this.curPlayer=this.raid.getPlayerFromUnitReference(r.getValue(s)),this.curUnitReference=this.getInputValue(),this.rootElem.innerHTML='\n\t\t\t<a\n\t\t\t\tclass="raid-target-picker-button"\n\t\t\t\thref="javascript:void(0)"\n\t\t\t\trole="button"\n\t\t\t\tdata-bs-toggle="dropdown"\n\t\t\t></a>\n\t\t\t<div class="dropdown-menu"></div>\n    ',this.buttonElem=this.rootElem.querySelector(".raid-target-picker-button"),this.dropdownElem=this.rootElem.querySelector(".dropdown-menu"),this.buttonElem.addEventListener("click",(e=>e.preventDefault())),this.currentOptions=[],this.updateOptions(p.nextEventID()),r.compChangeEmitter.on((e=>this.updateOptions(e))),this.init()}makeTargetOptions(){return[{player:null,isDropdown:!0},...this.raid.getPlayers().filter((e=>null!=e)).map((e=>({player:e,isDropdown:!0})))]}updateOptions(e){this.currentOptions=this.makeTargetOptions(),this.dropdownElem.innerHTML="",this.currentOptions.forEach((e=>this.dropdownElem.appendChild(this.makeOption(e))));const t=this.curUnitReference;this.curUnitReference=this.getInputValue(),j.equals(t,this.curUnitReference)?this.setInputValue(this.curUnitReference):this.inputChanged(e)}makeOption(e){const t=gi.makeOptionElem(e);return t.addEventListener("click",(t=>{t.preventDefault(),this.curPlayer=e.player,this.curUnitReference=this.getInputValue(),this.inputChanged(p.nextEventID())})),t}getInputElem(){return this.buttonElem}getInputValue(){return this.curPlayer?this.curPlayer.makeUnitReference():q()}setInputValue(e){this.curUnitReference=j.clone(e),this.curPlayer=this.raid.getPlayerFromUnitReference(this.curUnitReference);const t=this.currentOptions.find((e=>e.player==this.curPlayer));t&&(this.buttonElem.innerHTML=gi.makeOptionElem({player:t.player}).outerHTML)}static makeOptionElem(e){const t=e.player?u(e.player.getClass()):"";let a=document.createElement("fragment");return a.innerHTML=`\n\t\t\t<div class="player ${t?`bg-${t}-dampened`:""}">\n\t\t\t\t<div class="player-label">\n\t\t\t\t\t${e.player?`<img class="player-icon" src="${e.player.getSpecIcon()}" draggable="false"/>`:""}\n\t\t\t\t\t<div class="player-details">\n\t\t\t\t\t\t<span class="player-name ${t?`text-${t}`:""}">\n\t\t\t\t\t\t\t${e.player?e.player.getName():"Unassigned"}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,e.isDropdown&&(a.innerHTML=`\n\t\t\t\t<a class="dropdown-option" href="javascript:void(0) role="button">${a.innerHTML}</a>\n\t\t\t`),a.children[0]}}class fi extends c{constructor(e,a){super(e,"assignments-picker-root"),t(this,"raidSimUI"),t(this,"changeEmitter",new p),t(this,"innervatesPicker"),t(this,"powerInfusionsPicker"),t(this,"tricksOfTheTradesPicker"),t(this,"unholyFrenzyPicker"),t(this,"focusMagicsPicker"),this.raidSimUI=a,this.innervatesPicker=new Si(this.rootElem,a),this.powerInfusionsPicker=new Ii(this.rootElem,a),this.tricksOfTheTradesPicker=new Pi(this.rootElem,a),this.unholyFrenzyPicker=new bi(this.rootElem,a),this.focusMagicsPicker=new ki(this.rootElem,a)}}class yi extends c{constructor(e,a){super(e,"assigned-buff-picker-root"),t(this,"raidSimUI"),t(this,"changeEmitter",new p),t(this,"playersContainer"),t(this,"targetPickers"),this.raidSimUI=a,this.targetPickers=[],this.playersContainer=document.createElement("div"),this.playersContainer.classList.add("assigned-buff-container"),this.rootElem.appendChild(this.playersContainer),this.raidSimUI.changeEmitter.on((e=>this.update())),this.update()}update(){this.playersContainer.innerHTML=`\n\t\t\t<label class="assignmented-buff-label form-label">${this.getTitle()}</label>\n\t\t`;const e=this.getSourcePlayers();0==e.length?this.rootElem.classList.add("hide"):this.rootElem.classList.remove("hide"),this.targetPickers=e.map(((e,t)=>{const a=document.createElement("div");a.classList.add("assigned-buff-player","input-inline"),this.playersContainer.appendChild(a);let s=document.createElement("div");s.classList.add("raid-target-picker-root"),s.appendChild(gi.makeOptionElem({player:e,isDropdown:!1})),a.appendChild(s);const r=document.createElement("i");r.classList.add("assigned-buff-arrow","fa","fa-arrow-right"),a.appendChild(r);const i=new gi(a,this.raidSimUI.sim.raid,e,{extraCssClasses:["assigned-buff-target-picker"],noTargetLabel:"Unassigned",compChangeEmitter:this.raidSimUI.sim.raid.compChangeEmitter,changedEvent:e=>e.specOptionsChangeEmitter,getValue:e=>this.getPlayerValue(e),setValue:(e,t,a)=>this.setPlayerValue(e,t,a)}),n={player:e,targetPicker:i,targetPlayer:this.raidSimUI.sim.raid.getPlayerFromUnitReference(i.getInputValue())};return i.changeEmitter.on((e=>{n.targetPlayer=this.raidSimUI.sim.raid.getPlayerFromUnitReference(i.getInputValue())})),n}))}}class Si extends yi{getTitle(){return"Innervate"}getSourcePlayers(){return this.raidSimUI.getActivePlayers().filter((e=>e.isClass(l.ClassDruid)))}getPlayerValue(e){return e.getSpecOptions().innervateTarget||q()}setPlayerValue(e,t,a){const s=t.getSpecOptions();s.innervateTarget=a,t.setSpecOptions(e,s)}}class Ii extends yi{getTitle(){return"Power Infusion"}getSourcePlayers(){return this.raidSimUI.getActivePlayers().filter((e=>e.isClass(l.ClassPriest)&&e.getTalents().powerInfusion))}getPlayerValue(e){return e.getSpecOptions().powerInfusionTarget||q()}setPlayerValue(e,t,a){const s=t.getSpecOptions();s.powerInfusionTarget=a,t.setSpecOptions(e,s)}}class Pi extends yi{getTitle(){return"Tricks of the Trade"}getSourcePlayers(){return this.raidSimUI.getActivePlayers().filter((e=>e.isClass(l.ClassRogue)))}getPlayerValue(e){return e.getSpecOptions().tricksOfTheTradeTarget||q()}setPlayerValue(e,t,a){const s=t.getSpecOptions();s.tricksOfTheTradeTarget=a,t.setSpecOptions(e,s)}}class bi extends yi{getTitle(){return"Unholy Frenzy"}getSourcePlayers(){return this.raidSimUI.getActivePlayers().filter((e=>e.isClass(l.ClassDeathknight)&&e.getTalents().hysteria))}getPlayerValue(e){return e.getSpecOptions().unholyFrenzyTarget||q()}setPlayerValue(e,t,a){const s=t.getSpecOptions();s.unholyFrenzyTarget=a,t.setSpecOptions(e,s)}}class ki extends yi{getTitle(){return"Focus Magic"}getSourcePlayers(){return this.raidSimUI.getActivePlayers().filter((e=>e.isClass(l.ClassMage)))}getPlayerValue(e){return e.getSpecOptions().focusMagicTarget||q()}setPlayerValue(e,t,a){const s=t.getSpecOptions();s.focusMagicTarget=a,t.setSpecOptions(e,s)}}class Di extends c{constructor(e,a){super(e,"blessings-picker-root"),t(this,"simUI"),t(this,"changeEmitter",new p),t(this,"pickers",[]),t(this,"assignments"),this.simUI=a,this.assignments=$.clone(V(4));const s=_.filter((e=>zr.includes(e))).filter((e=>!Ie.includes(e))),r=[...Array(4).keys()];s.map((e=>{const t=document.createElement("div");t.classList.add("blessings-picker-row"),this.rootElem.appendChild(t),t.append(this.buildSpecIcon(e));const a=document.createElement("div");return a.classList.add("blessings-picker-container"),t.appendChild(a),r.forEach((t=>{this.pickers[t]||this.pickers.push([]);const s=new Se(a,this,{extraCssClasses:["blessing-picker"],numColumns:1,values:[{color:z[l.ClassPaladin],value:J.BlessingUnknown},{actionId:E.fromSpellId(25898),value:J.BlessingOfKings},{actionId:E.fromSpellId(48934),value:J.BlessingOfMight},{actionId:E.fromSpellId(48938),value:J.BlessingOfWisdom},{actionId:E.fromSpellId(25899),value:J.BlessingOfSanctuary}],equals:(e,t)=>e==t,zeroValue:J.BlessingUnknown,enableWhen:e=>{const a=Math.min(this.simUI.getClassCount(l.ClassPaladin),4);return t<a},changedEvent:e=>e.changeEmitter,getValue:a=>a.assignments.paladins[t]?.blessings[e]||J.BlessingUnknown,setValue:(a,s,r)=>{s.assignments.paladins[t].blessings[e]!=r&&(s.assignments.paladins[t].blessings[e]=r,this.changeEmitter.emit(a))}});this.pickers[t].push(s)})),t})),this.updatePickers(),this.simUI.compChangeEmitter.on((e=>this.updatePickers()))}updatePickers(){for(let e=0;e<4;e++)this.pickers[e].forEach((e=>e.update()))}buildSpecIcon(e){let t=document.createElement("fragment");t.innerHTML=`\n\t\t\t<div class="blessings-picker-spec">\n\t\t\t\t<img\n\t\t\t\t\tsrc="${K[e]}"\n\t\t\t\t\tclass="blessings-spec-icon"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t`;const s=t.querySelector(".blessings-spec-icon");return a.getOrCreateInstance(s,{title:o[e]}),t.children[0]}getAssignments(){return $.clone(this.assignments)}setAssignments(e,t){this.assignments=$.clone(t),this.changeEmitter.emit(e)}}class Ei extends c{constructor(e,a){super(e,"tanks-picker-root"),t(this,"raidSimUI"),this.raidSimUI=a;const s=this.raidSimUI.sim.raid;for(let t=0;t<4;t++){const e=document.createElement("div");e.classList.add("tank-picker-row","input-inline"),this.rootElem.appendChild(e);const a=document.createElement("label");a.textContent=0==t?"Main Tank":`Tank ${t+1}`,a.classList.add("tank-picker-label","form-label"),e.appendChild(a),new gi(e,s,s,{extraCssClasses:["tank-picker"],noTargetLabel:"Unassigned",compChangeEmitter:s.compChangeEmitter,changedEvent:e=>e.tanksChangeEmitter,getValue:e=>e.getTanks()[t]||q(),setValue:(e,a,s)=>{const r=a.getTanks();for(let i=0;i<t;i++)r[i]||r.push(q());r[t]=s,a.setTanks(e,r)}})}}}class Ci extends fe{constructor(e,a){super(e,a,{identifier:"raid-settings-tab",title:"Settings"}),t(this,"simUI"),t(this,"leftPanel"),t(this,"rightPanel"),t(this,"column1",this.buildColumn(1,"raid-settings-col")),t(this,"column2",this.buildColumn(2,"raid-settings-col")),t(this,"column3",this.buildColumn(3,"raid-settings-col")),this.simUI=a,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("raid-settings-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.leftPanel.appendChild(this.column2),this.leftPanel.appendChild(this.column3),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("raid-settings-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildEncounterSettings(),this.buildConsumesSettings(),this.buildOtherSettings(),this.buildTankSettings(),this.buildAssignmentSettings(),this.buildBlessingsPicker(),this.buildSavedDataPickers()}buildEncounterSettings(){const e=new Pe(this.column1,"encounter-settings",{header:{title:"Encounter"}});new be(e.bodyElement,this.simUI.sim.encounter,{showExecuteProportion:!0},this.simUI)}buildConsumesSettings(){const e=new Pe(this.column1,"consumes-settings",{header:{title:"Consumables"}});let t=document.createElement("div");t.classList.add("consumes-container"),e.bodyElement.appendChild(t),this.makeBooleanRaidIconBuffInput(t,E.fromItemId(37094),"scrollOfStamina"),this.makeBooleanRaidIconBuffInput(t,E.fromItemId(43466),"scrollOfStrength"),this.makeBooleanRaidIconBuffInput(t,E.fromItemId(43464),"scrollOfAgility"),this.makeBooleanRaidIconBuffInput(t,E.fromItemId(37092),"scrollOfIntellect"),this.makeBooleanRaidIconBuffInput(t,E.fromItemId(37098),"scrollOfSpirit"),this.makeBooleanRaidIconBuffInput(t,E.fromItemId(43468),"scrollOfProtection"),this.makeBooleanRaidIconBuffInput(t,E.fromItemId(49633),"drumsOfForgottenKings"),this.makeBooleanRaidIconBuffInput(t,E.fromItemId(49634),"drumsOfTheWild")}buildOtherSettings(){}buildTankSettings(){const e=new Pe(this.column2,"tanks-settings",{header:{title:"Tanks"}});new Ei(e.bodyElement,this.simUI)}buildAssignmentSettings(){const e=new Pe(this.column2,"assignments-settings",{header:{title:"External Buffs"}});new fi(e.bodyElement,this.simUI)}buildBlessingsPicker(){const e=new Pe(this.column3,"blessings-settings",{header:{title:"Blessings",tooltip:ke}});this.simUI.blessingsPicker=new Di(e.bodyElement,this.simUI),this.simUI.blessingsPicker.changeEmitter.on((e=>this.simUI.changeEmitter.emit(e)))}buildSavedDataPickers(){const e=new ye(this.rightPanel,this.simUI.sim.encounter,{label:"Encounter",header:{title:"Saved Encounters"},storageKey:this.simUI.getSavedEncounterStorageKey(),getData:e=>X.create({encounter:e.toProto()}),setData:(e,t,a)=>t.fromProto(e,a.encounter),changeEmitters:[this.simUI.sim.encounter.changeEmitter],equals:(e,t)=>X.equals(e,t),toJson:e=>X.toJson(e),fromJson:e=>X.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData()}))}makeBooleanRaidIconBuffInput(e,t,a){const s=this.simUI.sim.raid;return new De(e,s,{id:t,states:2,changedEvent:e=>e.buffsChangeEmitter,getValue:e=>e.getBuffs()[a],setValue:(e,t,s)=>{const r=t.getBuffs();r[a]=s,t.setBuffs(e,r)}})}}class Ri extends Ee{constructor(e,a){super(e,a,"JSON Import",!0),t(this,"simUI"),this.simUI=a,this.descriptionElem.innerHTML="\n\t\t\t<p>\n\t\t\t\tImport settings from a JSON text file, which can be created using the JSON Export feature of this site.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the JSON text below and click, 'Import'.\n\t\t\t</p>\n\t\t"}onImport(e){const t=Q.fromJsonString(e,{ignoreUnknownFields:!0});this.simUI.fromProto(p.nextEventID(),t),this.close()}}class wi extends Ce{constructor(e,a){super(e,a,"JSON Export",!0),t(this,"simUI"),this.simUI=a,this.init()}getData(){return JSON.stringify(Q.toJson(this.simUI.toProto()),null,2)}}class vi extends Ee{constructor(e,a){super(e,a,"WCL Import",!1),t(this,"queryCounter",0),t(this,"simUI"),t(this,"token",""),this.simUI=a,this.textElem.classList.add("small-textarea"),this.descriptionElem.innerHTML="\n\t\t\t<p>\n\t\t\t\tImports the entire raid from a WCL report.<br>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the WCL report and fight link (https://classic.warcraftlogs.com/reports/REPORTID#fight=FIGHTID).<br>\n\t\t\t\tInclude the fight ID or else the first fight in the report will be used.<br>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThe following are imported directly from the report:\n\t\t\t\t<ul>\n\t\t\t\t\t<li>Player Name</li>\n\t\t\t\t\t<li>Equipment (items, enchants, and gems)</li>\n\t\t\t\t\t<li>Faction (Alliance / Horde)</li>\n\t\t\t\t\t<li>Encounter: If the import link has a fight ID we try to match with a preset Encounter. Note that many Encounters are still unimplemented.</li>\n\t\t\t\t</ul>\n\n\t\t\t\tThe following are not available directly from the report data, but we try to infer them:\n\t\t\t\t<ul>\n\t\t\t\t\t<li>Talents: Log data only gives us the tree summary (e.g. '51/20/0') so we match this with the closest preset talent build.</li>\n\t\t\t\t\t<li>Glyphs: Glyphs are absent from log data, but we pair them with the inferred Talents.</li>\n\t\t\t\t\t<li>Race: Inferred from Race-specific abilties used in any fight if possible, or defaults to Spec-specific Race.</li>\n\t\t\t\t\t<li>Professions: Inferred from profession-locked items/enchants/gems.</li>\n\t\t\t\t\t<li>Buff assignments (Innervate, Unholy Frenzy, etc): Inferred from casts.</li>\n\t\t\t\t\t<li>Party Composition: Inferred from party-only effects, such as Heroic Presence, Prayer of Healing, or Vampiric Touch.</li>\n\t\t\t\t</ul>\n\n\t\t\t\tThe following are not imported, and instead use spec-specific defaults:\n\t\t\t\t<ul>\n\t\t\t\t\t<li>Rotation / Spec-specific options</li>\n\t\t\t\t\t<li>Consumes</li>\n\t\t\t\t\t<li>Paladin Blessings</li>\n\t\t\t\t</ul>\n\t\t\t</p>\n\t\t"}async getWCLBearerToken(){if(""==this.token){const e=await fetch("https://classic.warcraftlogs.com/oauth/token",{method:"POST",headers:{Authorization:"Basic "+btoa("963d31c8-7efa-4dde-87cf-1b254a8a2f8c:lRJVhujEEnF96xfUoxVHSpnqKN9v8bTqGEjutsO3")},body:new URLSearchParams({grant_type:"client_credentials"})}),t=await e.json();this.token=t.access_token}return this.token}async queryWCL(e){const t={"Content-Type":"application/json",Authorization:`Bearer ${await this.getWCLBearerToken()}`,Accept:"application/json"},a=`https://classic.warcraftlogs.com/api/v2/client?query=${e}`;this.queryCounter++;const s=await fetch(encodeURI(a),{method:"GET",headers:t}),r=await s.json();if(r?.errors?.length){const t=r.errors.map((e=>e.message)).join("\n");throw new Error(`GraphQL error: ${t}\n\nQuery: ${e}`)}return console.debug(`WCL query: ${e}\n\nResult: ${JSON.stringify(r)}`),r}async parseURL(e){const t=e.match(/classic\.warcraftlogs\.com\/reports\/([a-zA-Z0-9:]+)\/?(#.*fight=((\d+)|(last)))?/);if(!t)throw new Error(`Invalid WCL URL ${e}, must look like "classic.warcraftlogs.com/reports/XXXX"`);const a={reportID:t[1],fightID:""};if(t[2]&&t[3]&&"last"!=t[3])a.fightID=t[3];else{const e=`{\n\t\t\t\treportData {\n\t\t\t\t\treport(code: "${a.reportID}") {\n\t\t\t\t\t\tfights(killType: Kills, translate: true) {\n\t\t\t\t\t\t\tid, name\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}`,s=(await this.queryWCL(e)).data.reportData.report.fights;"last"==t[3]?a.fightID=String(s[s.length-1].id):a.fightID=String(s[0].id)}return console.debug(`Importing WCL report: ${JSON.stringify(a)}`),a}async getRateLimit(){return(await this.queryWCL("{\n\t    rateLimitData {\n\t      limitPerHour, pointsSpentThisHour, pointsResetIn\n\t    }\n\t  }")).data.rateLimitData}async onImport(e){this.importButton.disabled=!0,this.rootElem.style.cursor="wait";try{await this.doImport(e)}catch(t){console.error(t),alert("Failed import from WCL: "+t)}this.importButton.disabled=!1,this.rootElem.style.removeProperty("cursor")}async doImport(e){if(!e.length)throw new Error("No import link provided!");const t=await this.parseURL(e);await this.getRateLimit();const a=`{\n\t\t\treportData {\n\t\t\t\treport(code: "${t.reportID}") {\n\t\t\t\t\tguild {\n\t\t\t\t\t\tname faction {id}\n\t\t\t\t\t}\n\t\t\t\t\tplayerDetails: table(fightIDs: [${t.fightID}], dataType: Casts, killType: All, viewBy: Default)\n\t\t\t\t\tcombatantInfoEvents: events(fightIDs: [${t.fightID}], dataType:CombatantInfo, limit: 50) { data }\n\t\t\t\t\tfights(fightIDs: [${t.fightID}]) {\n\t\t\t\t\t\tstartTime, endTime, id, name\n\t\t\t\t\t}\n\n\t\t\t\t\treportCastEvents: events(dataType:Casts, endTime: 99999999, filterExpression: "${[Oi,Ai].flat().map((e=>e.id)).map((e=>`ability.id = ${e}`)).join(" OR ")}", limit: 10000) { data }\n\n\t\t\t\t\tfightCastEvents: events(fightIDs: [${t.fightID}], dataType:Casts, filterExpression: "${[Hi].flat().map((e=>e.id)).map((e=>`ability.id = ${e}`)).join(" OR ")}", limit: 10000) { data }\n\n\t\t\t\t\tfightHealEvents: events(fightIDs: [${t.fightID}], dataType:Healing, filterExpression: "${[Fi,Wi].flat().map((e=>e.id)).map((e=>`ability.id = ${e}`)).join(" OR ")}", limit: 10000) { data }\n\n\t\t\t\t\tmanaTideTotem: events(fightIDs: [${t.fightID}], dataType:Resources, filterExpression: "ability.id = 39609", limit: 100) { data }\n\t\t\t\t}\n\t\t\t}\n\t\t}`,s=(await this.queryWCL(a)).data.reportData.report,r=s.playerDetails.data.entries;p.freezeAllAndDo((()=>{const e=p.nextEventID(),t=r.map((t=>new Ui(t,this.simUI,e)));this.inferRace(e,s,t),this.inferProfessions(e,s,t),this.inferAssignments(e,s,t),this.inferPartyComposition(e,s,t);const a=t.filter((e=>e.player.getClass()==l.ClassPaladin)).length,i=Q.create({encounter:this.getEncounterProto(s),raid:this.getRaidProto(t),blessings:V(a)});this.simUI.clearRaid(e),this.simUI.fromProto(e,i)})),this.close()}inferRace(e,t,a){a.forEach((t=>t.player.setRace(e,i.RaceUnknown)));let s=t.guild?.faction?.id||this.simUI.raidPicker?.getCurrentFaction()||r.Horde;t.combatantInfoEvents.data.forEach((t=>{t.auras.filter((e=>28878==e.ability)).forEach((t=>{const n=a.find((e=>e.id==t.source));n&&n.player.getRace()!=i.RaceDraenei&&(console.log(`Inferring player ${n.name} has race ${Y.get(i.RaceDraenei)} from Heroic Presence aura event`),n.player.setRace(e,i.RaceDraenei),s=r.Alliance)}))}));const n=Z(t.reportCastEvents.data,(e=>String(e.abilityGameID)));Oi.forEach((t=>{(n[t.id]||[]).forEach((r=>{const i=a.find((e=>e.id==r.sourceID));i&&(console.log(`Inferring player ${i.name} has race ${Y.get(t.race)} from ${t.name} event`),i.player.setRace(e,t.race),s=ee[t.race])}))})),a.forEach((t=>{t.player.getRace()==i.RaceUnknown&&t.player.setRace(e,t.preset.defaultFactionRaces[s])}))}inferProfessions(e,t,a){const s=Z(t.reportCastEvents.data,(e=>String(e.abilityGameID)));Ai.forEach((e=>{(s[e.id]||[]).forEach((t=>{const s=a.find((e=>e.id==t.sourceID));s&&!s.inferredProfessions.includes(e.profession)&&(console.log(`Inferring player ${s.name} has profession ${te.get(e.profession)} from ${e.name} event`),s.inferredProfessions.push(e.profession))}))})),a.forEach((t=>{let a=ae(t.inferredProfessions.concat(t.player.getGear().getProfessionRequirements()));0==a.length?a=[S.Engineering,S.Jewelcrafting]:1==a.length&&(a[0]!=S.Engineering?a.push(S.Engineering):a.push(S.Jewelcrafting)),t.player.setProfessions(e,a)}))}inferAssignments(e,t,a){const s=Z(t.fightCastEvents.data,(e=>String(e.abilityGameID)));Hi.forEach((t=>{(s[t.id]||[]).forEach((s=>{const r=a.find((e=>e.id==s.sourceID)),i=a.find((e=>e.id==s.targetID));if(r&&i&&r.player.getClass()==t.class){const a=t.applyFunc(r.player,i.toUnitReference());r.player.setSpecOptions(e,a),console.log(`Inferring player ${r.name} is targeting ${i.name} with ${t.name} from cast event`)}}))}))}inferPartyComposition(e,t,a){const s=(e,t,a)=>{(e.addPlayerInParty(t)||t.addPlayerInParty(e))&&console.log(`Inferring players ${e.name} and ${t.name} in same party from ${a} event`)},r=Z(t.fightHealEvents.data,(e=>String(e.abilityGameID)));Fi.forEach((e=>{(r[e.id]||[]).forEach((t=>{const r=a.find((e=>e.id==t.sourceID)),i=a.find((e=>e.id==t.targetID));r&&i&&s(r,i,e.name)}))})),Wi.forEach((e=>{const t=r[e.id]||[],i=Z(t,(e=>String(e.timestamp)+String(e.sourceID)));for(const[r,n]of Object.entries(i)){const t=n.map((e=>a.find((t=>t.id==e.targetID))));for(let a=0;a<t.length;a++)for(let r=0;r<t.length;r++)a!=r&&t[a]&&t[r]&&s(t[a],t[r],e.name)}})),t.combatantInfoEvents.data.forEach((e=>{const t=a.find((t=>t.id==e.sourceID));e.auras.filter((e=>28878==e.ability)).forEach((e=>{const r=a.find((t=>t.id==e.source));r&&t&&s(r,t,"Heroic Presence")}))}));let i=a.filter((e=>e.playersInParty.length>0)),n=0;for(;i.length>0;){let e=[i[0]].concat(i[0].playersInParty),t=0;for(;e.length!=t;)t=e.length,e=ae(e.map((e=>[e].concat(e.playersInParty))).flat());const a=n;n++,e.forEach(((e,t)=>{e.raidIndex=5*a+t})),i=i.filter((t=>!e.includes(t)))}const l=[...Array(40).keys()];a.filter((e=>-1==e.raidIndex)).forEach((e=>{const t=l.find((e=>!a.some((t=>t.raidIndex==e))))??-1;if(-1==t)throw new Error("Invalid next idx");e.raidIndex=t}))}getEncounterProto(e){const t=e.fights[0],a=se.create({duration:(t.endTime-t.startTime)/1e3,targets:[]});let s=this.simUI.sim.db.getAllPresetEncounters().find((e=>e.path.includes(t.name)));return s&&s.targets.length&&s.targets.map((e=>e.target)).filter((e=>void 0!==e)).forEach((e=>a.targets.push(e))),0===a.targets.length&&a.targets.push(Re.defaultTargetProto()),a}getRaidProto(e){const t=N.create({parties:[...new Array(we).keys()].map((e=>re.create({players:[...new Array(5).keys()].map((e=>m.create()))})))});return e.forEach((e=>{const a=e.raidIndex%5,s=(e.raidIndex-a)/5,r=e.player.toProto();t.parties[s].players[a]=r,I(h(r))&&t.tanks.push(e.toUnitReference())})),t}}class Ui{constructor(e,a,s){t(this,"data"),t(this,"id"),t(this,"name"),t(this,"type"),t(this,"raidIndex",-1),t(this,"simUI"),t(this,"fullType"),t(this,"spec"),t(this,"player"),t(this,"preset"),t(this,"inferredProfessions",[]),t(this,"playersInParty",[]),this.simUI=a,this.data=e,this.name=e.name,this.id=e.id,this.type=e.type;const r=e.icon.split("-")[1];this.fullType=this.type+r,console.log(`WCL spec: ${this.fullType}`);const i=Ti[this.fullType]??null;if(null==i)throw new Error("Player type not implemented: "+this.fullType);if(this.spec=i,this.player=new ue(this.spec,a.sim),this.preset=Ui.getMatchingPreset(i,e.talents),void 0===this.preset)throw new Error("Could not find matching preset: "+JSON.stringify({name:this.name,type:this.fullType,talents:e.talents}).toString());this.player.applySharedDefaults(s),this.player.setTalentsString(s,this.preset.talents.talentsString),this.player.setGlyphs(s,this.preset.talents.glyphs),this.player.setConsumes(s,this.preset.consumes),this.player.setRotation(s,this.preset.rotation),this.player.setSpecOptions(s,this.preset.specOptions),this.player.setProfessions(s,[S.Engineering,S.Jewelcrafting]),this.player.setName(s,e.name),this.player.setGear(s,a.sim.db.lookupEquipmentSpec(ie.create({items:e.gear.map((e=>ne.create({id:e.id,enchant:e.permanentEnchant,gems:e.gems?e.gems.map((e=>e.id)):[]})))})))}static getMatchingPreset(e,t){const a=Vr.filter((t=>t.spec==e));let s=0;if(a&&a.length>1){let e=999;a.forEach(((a,r)=>{const i=le(a.talents.talentsString),n=i.reduce(((e,a,s)=>e+Math.abs(t[s]?.guid-i[s])),0);n<e&&(s=r,e=n)}))}return a[s]}toUnitReference(){return j.create({type:oe.Player,index:this.raidIndex})}addPlayerInParty(e){return e!=this&&!this.playersInParty.includes(e)&&(this.playersInParty.push(e),!0)}}const Ti={DeathKnightBlood:s.SpecTankDeathknight,DeathKnightLichborne:s.SpecTankDeathknight,DeathKnightRuneblade:s.SpecDeathknight,DeathKnightBloodDPS:s.SpecDeathknight,DeathKnightFrost:s.SpecDeathknight,DeathKnightUnholy:s.SpecDeathknight,DruidBalance:s.SpecBalanceDruid,DruidFeral:s.SpecFeralDruid,DruidWarden:s.SpecFeralTankDruid,DruidGuardian:s.SpecFeralTankDruid,DruidRestoration:s.SpecRestorationDruid,HunterBeastMastery:s.SpecHunter,HunterSurvival:s.SpecHunter,HunterMarksmanship:s.SpecHunter,MageArcane:s.SpecMage,MageFire:s.SpecMage,MageFrost:s.SpecMage,PaladinHoly:s.SpecHolyPaladin,PaladinJusticar:s.SpecProtectionPaladin,PaladinProtection:s.SpecProtectionPaladin,PaladinRetribution:s.SpecRetributionPaladin,PriestHoly:s.SpecHealingPriest,PriestDiscipline:s.SpecHealingPriest,PriestShadow:s.SpecShadowPriest,PriestSmite:s.SpecSmitePriest,RogueAssassination:s.SpecRogue,RogueCombat:s.SpecRogue,RogueSubtlety:s.SpecRogue,ShamanElemental:s.SpecElementalShaman,ShamanEnhancement:s.SpecEnhancementShaman,ShamanRestoration:s.SpecRestorationShaman,WarlockDestruction:s.SpecWarlock,WarlockAffliction:s.SpecWarlock,WarlockDemonology:s.SpecWarlock,WarriorArms:s.SpecWarrior,WarriorFury:s.SpecWarrior,WarriorChampion:s.SpecWarrior,WarriorWarrior:s.SpecWarrior,WarriorGladiator:s.SpecWarrior,WarriorProtection:s.SpecProtectionWarrior},Oi=[{id:25046,name:"Arcane Torrent (Energy)",race:i.RaceBloodElf},{id:28730,name:"Arcane Torrent (Mana)",race:i.RaceBloodElf},{id:50613,name:"Arcane Torrent (Runic Power)",race:i.RaceBloodElf},{id:26297,name:"Berserking",race:i.RaceTroll},{id:20572,name:"Blood Fury (AP)",race:i.RaceOrc},{id:33697,name:"Blood Fury (AP+SP)",race:i.RaceOrc},{id:33702,name:"Blood Fury (SP)",race:i.RaceOrc},{id:20589,name:"Escape Artist",race:i.RaceGnome},{id:20594,name:"Stoneform",race:i.RaceDwarf},{id:20549,name:"War Stomp",race:i.RaceTauren},{id:7744,name:"Will of the Forsaken",race:i.RaceUndead},{id:59752,name:"Will to Survive",race:i.RaceHuman}],Ai=[{id:55503,name:"Lifeblood",profession:S.Herbalism},{id:50305,name:"Skinning",profession:S.Skinning}],Hi=[{id:29166,name:"Innervate",class:l.ClassDruid,applyFunc:(e,t)=>{const a=e.getSpecOptions();return a.innervateTarget=t,a}},{id:10060,name:"Power Infusion",class:l.ClassPriest,applyFunc:(e,t)=>{const a=e.getSpecOptions();return a.powerInfusionTarget=t,a}},{id:57933,name:"Tricks of the Trade",class:l.ClassRogue,applyFunc:(e,t)=>{const a=e.getSpecOptions();return a.tricksOfTheTradeTarget=t,a}},{id:49016,name:"Unholy Frenzy",class:l.ClassDeathknight,applyFunc:(e,t)=>{const a=e.getSpecOptions();return a.unholyFrenzyTarget=t,a}}],Fi=[{id:52042,name:"Healing Stream Totem"},{id:48076,name:"Holy Nova"},{id:48445,name:"Tranquility"},{id:15290,name:"Vampiric Embrace"}],Wi=[{id:48072,name:"Prayer of Healing"}],Bi=[];new class extends ve{constructor(e,a){super(e,new Ue,{cssClass:"raid-sim-ui",cssScheme:"raid",spec:null,launchStatus:Te,knownIssues:(a.knownIssues||[]).concat(Bi)}),t(this,"config"),t(this,"raidSimResultsManager",null),t(this,"raidPicker",null),t(this,"blessingsPicker",null),t(this,"compChangeEmitter",new p),t(this,"changeEmitter",new p),t(this,"referenceChangeEmitter",new p),this.config=a,this.sim.raid.compChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),[this.compChangeEmitter,this.sim.changeEmitter].forEach((e=>e.on((e=>this.changeEmitter.emit(e))))),this.changeEmitter.on((()=>this.recomputeSettingsLayout())),this.sim.setModifyRaidProto((e=>this.modifyRaidProto(e))),this.sim.waitForInit().then((()=>this.loadSettings())),this.addSidebarComponents(),this.addTopbarComponents(),this.addRaidTab(),this.addSettingsTab(),this.addDetailedResultsTab()}loadSettings(){const e=p.nextEventID();p.freezeAllAndDo((()=>{let t=!1;const a=window.localStorage.getItem(this.getSettingsStorageKey());if(null!=a)try{const s=Q.fromJsonString(a);this.fromProto(e,s),t=!0}catch(s){console.warn("Failed to parse saved settings: "+s)}t||this.applyDefaults(e),this.changeEmitter.on((e=>{const t=Q.toJsonString(this.toProto());window.localStorage.setItem(this.getSettingsStorageKey(),t)}))}))}addSidebarComponents(){this.raidSimResultsManager=ce(this),this.raidSimResultsManager.changeEmitter.on((e=>this.referenceChangeEmitter.emit(e)))}addTopbarComponents(){this.simHeader.addImportLink("JSON",(e=>new Ri(this.rootElem,this))),this.simHeader.addImportLink("WCL",(e=>new vi(this.rootElem,this))),this.simHeader.addExportLink("JSON",(e=>new wi(this.rootElem,this)))}addRaidTab(){new ui(this.simTabContentsContainer,this)}addSettingsTab(){new Ci(this.simTabContentsContainer,this)}addDetailedResultsTab(){this.addTab("Results","detailed-results-tab",'\n\t\t\t<div class="detailed-results">\n\t\t\t</div>\n\t\t'),new de(this.rootElem.getElementsByClassName("detailed-results")[0],this,this.raidSimResultsManager)}recomputeSettingsLayout(){window.dispatchEvent(new Event("resize"))}modifyRaidProto(e){const t=this.getClassCount(l.ClassPaladin),a=this.blessingsPicker.getAssignments();zr.forEach((s=>{const r=e.parties.map((e=>e.players.filter((e=>e.class!=l.ClassUnknown&&h(e)==s)))).flat();a.paladins.forEach(((e,a)=>{a>=t||(e.blessings[s]==J.BlessingOfKings?r.forEach((e=>e.buffs.blessingOfKings=!0)):e.blessings[s]==J.BlessingOfMight?r.forEach((e=>e.buffs.blessingOfMight=pe.TristateEffectImproved)):e.blessings[s]==J.BlessingOfWisdom?r.forEach((e=>e.buffs.blessingOfWisdom=pe.TristateEffectImproved)):e.blessings[s]==J.BlessingOfSanctuary&&r.forEach((e=>e.buffs.blessingOfSanctuary=!0)))}))}))}getCurrentData(){return this.raidSimResultsManager?this.raidSimResultsManager.getCurrentData():null}getReferenceData(){return this.raidSimResultsManager?this.raidSimResultsManager.getReferenceData():null}getActivePlayers(){return this.sim.raid.getActivePlayers()}getClassCount(e){return this.getActivePlayers().filter((t=>t.isClass(e))).length}applyDefaults(e){p.freezeAllAndDo((()=>{this.sim.raid.fromProto(e,N.create({numActiveParties:5})),this.sim.setPhase(e,1),this.sim.encounter.applyDefaults(e),this.sim.applyDefaults(e,!0,!0),this.sim.setShowDamageMetrics(e,!0)}))}toProto(){return Q.create({settings:this.sim.toProto(),raid:this.sim.raid.toProto(!0),blessings:this.blessingsPicker.getAssignments(),encounter:this.sim.encounter.toProto()})}toLink(){const e=this.toProto();e.settings=void 0;const t=Q.toBinary(e),a=pako.deflate(t,{to:"string"}),s=btoa(String.fromCharCode(...a)),r=new URL(window.location.href);return r.hash=s,r.toString()}fromProto(e,t){p.freezeAllAndDo((()=>{t.settings&&this.sim.fromProto(e,t.settings),this.sim.raid.fromProto(e,t.raid||N.create()),this.sim.encounter.fromProto(e,t.encounter||se.create()),this.blessingsPicker.setAssignments(e,t.blessings||$.create())}))}clearRaid(e){this.sim.raid.clear(e)}getStorageKey(e){return"__wotlk_raid__"+e}getSavedRaidStorageKey(){return this.getStorageKey("__savedRaid__")}}(document.body,{});
//# sourceMappingURL=index-99715156.entry.js.map
